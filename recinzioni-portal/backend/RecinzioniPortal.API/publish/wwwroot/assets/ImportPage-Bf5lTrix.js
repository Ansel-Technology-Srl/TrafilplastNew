<<<<<<<< HEAD:recinzioni-portal/backend/RecinzioniPortal.API/publish/wwwroot/assets/ImportPage-Bf5lTrix.js
import{j as e}from"./vendor-three-CHCIWYOy.js";import{r as t}from"./vendor-react-DmByJA4P.js";import{a as r}from"./index-DfURxQoa.js";import{u as s}from"./formatters-BFOEvdlG.js";import{P as a,a2 as l,U as o,a3 as i,m as c,a4 as n,D as m,a as d,a5 as p,X as x,R as y,C as g,o as b,z as h,v as u,a6 as j}from"./vendor-ui-CwcPvQqL.js";import{u as f}from"./vendor-i18n-BveTNVnu.js";const N=[{key:"prodotti",icon:a,labelKey:"import.products"},{key:"prezzi",icon:l,labelKey:"import.prices"},{key:"clienti",icon:o,labelKey:"import.clients"},{key:"puntivendita",icon:i,labelKey:"import.branches"}],w={prodotti:[{key:"prdCod",labelKey:"import.col.code",w:"w-32"},{key:"prdDes",labelKey:"import.col.description",w:"flex-1"},{key:"prdUm",labelKey:"import.col.um",w:"w-20"},{key:"catCod",labelKey:"import.col.category",w:"w-28"},{key:"famCod",labelKey:"import.col.family",w:"w-28"},{key:"grpCod",labelKey:"import.col.group",w:"w-28"},{key:"cfgTipo",labelKey:"import.col.configuration",w:"w-28"},{key:"cfgColore",labelKey:"import.col.color",w:"w-20"}],prezzi:[{key:"prdCod",labelKey:"import.col.productCode",w:"flex-1"},{key:"lstCod",labelKey:"import.col.priceListCode",w:"flex-1"},{key:"prdPrz",labelKey:"import.col.price",w:"w-32",format:"price"}],clienti:[{key:"itemID",labelKey:"import.col.code",w:"w-28"},{key:"itemDes",labelKey:"import.col.companyName",w:"flex-1"},{key:"pIva",labelKey:"import.col.vatNumber",w:"w-36"},{key:"cFis",labelKey:"import.col.taxCode",w:"w-36"},{key:"ind",labelKey:"import.col.address",w:"w-40"},{key:"loc",labelKey:"import.col.city",w:"w-28"},{key:"pro",labelKey:"import.col.province",w:"w-16"},{key:"lstCod",labelKey:"import.col.priceList",w:"w-28"},{key:"pagCod",labelKey:"import.col.payment",w:"w-24"}],puntivendita:[{key:"itemID",labelKey:"import.col.customer",w:"w-24"},{key:"itemIDSede",labelKey:"import.col.branch",w:"w-24"},{key:"itemDes",labelKey:"import.col.description",w:"flex-1"},{key:"loc",labelKey:"import.col.city",w:"w-32"},{key:"pro",labelKey:"import.col.province",w:"w-16"},{key:"tel",labelKey:"import.col.phone",w:"w-32"},{key:"mail",labelKey:"import.col.email",w:"w-40"}]},v={prodotti:"PrdCod | PrdDes | PrdUm | PosArc | PrvCla | SitCod | GrpCod | CatCod | TreeCod | FamCod | DiBaCod | CfgTipo | CfgColore | PrdDes_EN | PrdDes_FR | PrdDes_DE",prezzi:"PrdCod | LstCod | PrdPrz",clienti:"ItemID | ItemDes | PIva | CFis | Ind | Cap | Loc | Pro | LstCod | LstCodPubb | PagCod",puntivendita:"ItemID | ItemIDSede | ItemDes | Ind | Cap | Loc | Pro | Reg | Naz | LstCod | LstCodPubb | PagCod | Tel | Mail"};function k(){const{t:s}=f(),[a,l]=t.useState("prodotti"),[o,i]=t.useState({prodotti:0,prezzi:0,clienti:0,puntivendita:0}),[c,n]=t.useState(!0);t.useEffect(()=>{m()},[]);const m=async()=>{n(!0);const e=await r.get("/import/counts");e?.success&&i(e.data),n(!1)};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("import.title")})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:N.map(t=>e.jsx("div",{className:"card p-4 cursor-pointer transition-all "+(a===t.key?"ring-2 ring-primary-500 bg-primary-50":"hover:shadow-md"),onClick:()=>l(t.key),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+(a===t.key?"bg-primary-100 text-primary-600":"bg-gray-100 text-gray-500"),children:e.jsx(t.icon,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:s(t.labelKey)}),e.jsx("p",{className:"text-xl font-bold "+(c?"text-gray-300":""),children:o[t.key]??0})]})]})},t.key))}),e.jsx("div",{className:"flex gap-1 mb-6 overflow-x-auto border-b border-gray-200",children:N.map(t=>e.jsxs("button",{onClick:()=>l(t.key),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap "+(a===t.key?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(t.icon,{size:16}),s(t.labelKey)]},t.key))}),e.jsx(C,{tabKey:a,onImportDone:m})]})}function C({tabKey:a,onImportDone:l}){const{t:o}=f(),i=s(),[u,j]=t.useState([]),[N,k]=t.useState(!0),[C,z]=t.useState(""),[D,P]=t.useState(1),[S,I]=t.useState(null),[L,R]=t.useState(!1),[E,F]=t.useState(!1);t.useEffect(()=>{z(""),P(1),R(!1),F(!1),j([]),I(null),$(a,1,"")},[a]);const $=async(e,t,s)=>{k(!0);const a=new URLSearchParams({page:String(t),pageSize:"10"});s&&a.set("search",s);const l=await r.get(`/import/${e}?${a}`);l?.success&&(j(l.data),I(l.pagination)),k(!1)},T=e=>{P(e),$(a,e,C)},U=w[a]||[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("form",{onSubmit:e=>{e.preventDefault(),P(1),$(a,1,C)},className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-72",children:[e.jsx(c,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",value:C,onChange:e=>z(e.target.value),placeholder:o("import.searchPlaceholder"),className:"input-field pl-10 text-sm"})]}),e.jsx("button",{type:"submit",className:"btn-primary text-sm",children:o("import.searchBtn")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>F(!E),className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(n,{size:15})," ",o("import.template")]}),e.jsxs("button",{onClick:async()=>{h.loading(o("import.exporting"),{id:"export"});const e=await r.downloadBlob(`/import/${a}/export`);if(e){const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`${a}_export.xlsx`,r.click(),URL.revokeObjectURL(t),h.success(o("import.exportDone"),{id:"export"})}else h.error(o("common.error"),{id:"export"})},className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(m,{size:15})," ",o("import.exportBtn")]}),e.jsxs("button",{onClick:()=>R(!L),className:"btn-primary flex items-center gap-1.5 text-sm",children:[e.jsx(d,{size:15})," ",o("import.importBtn")]})]})]}),E&&e.jsx("div",{className:"card bg-blue-50 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{size:20,className:"text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-blue-900 text-sm mb-1",children:o("import.templateTitle")}),e.jsx("p",{className:"text-xs text-blue-700 font-mono break-all",children:v[a]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:o("import.templateNote")})]}),e.jsx("button",{onClick:()=>F(!1),className:"text-blue-400 hover:text-blue-600",children:e.jsx(x,{size:16})})]})}),L&&e.jsx(K,{tabKey:a,onDone:()=>{R(!1),z(""),P(1),$(a,1,""),l?.()},onCancel:()=>R(!1)}),e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50 text-left text-gray-600 border-b",children:U.map(t=>e.jsx("th",{className:"px-4 py-3 font-medium whitespace-nowrap",children:o(t.labelKey)},t.key))})}),e.jsx("tbody",{children:N?e.jsx("tr",{children:e.jsxs("td",{colSpan:U.length,className:"text-center py-12 text-gray-400",children:[e.jsx(y,{className:"animate-spin inline mr-2",size:16}),o("app.loading")]})}):0===u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:U.length,className:"text-center py-12 text-gray-400",children:o("common.noData")})}):u.map((t,r)=>e.jsx("tr",{className:"border-t hover:bg-gray-50 transition-colors",children:U.map(r=>e.jsx("td",{className:"px-4 py-2.5 text-gray-700",children:"price"===r.format&&null!=t[r.key]?i.currency(t[r.key]):t[r.key]??"—"},r.key))},r))})]})}),S&&S.total>0&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:o("import.showing",{from:(S.page-1)*S.pageSize+1,to:Math.min(S.page*S.pageSize,S.total),total:S.total})}),S.totalPages>1&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>T(Math.max(1,D-1)),disabled:D<=1,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(g,{size:18})}),Array.from({length:Math.min(5,S.totalPages)},(t,r)=>{let s;return s=S.totalPages<=5||D<=3?r+1:D>=S.totalPages-2?S.totalPages-4+r:D-2+r,e.jsx("button",{onClick:()=>T(s),className:"px-3 py-1 rounded text-sm "+(D===s?"bg-primary-600 text-white":"hover:bg-gray-200 text-gray-600"),children:s},s)}),e.jsx("button",{onClick:()=>T(Math.min(S.totalPages,D+1)),disabled:D>=S.totalPages,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(b,{size:18})})]})]})]})]})}function K({tabKey:s,onDone:a,onCancel:l}){const{t:o}=f(),i=t.useRef(null),[c,n]=t.useState(null),[m,g]=t.useState("merge"),[b,N]=t.useState(!1),[w,v]=t.useState(null),[k,C]=t.useState(!1),K=t.useCallback(e=>{e.preventDefault(),C(!1);const t=e.dataTransfer?.files?.[0];t&&(t.name.endsWith(".xlsx")||t.name.endsWith(".csv"))?(n(t),v(null)):h.error(o("import.invalidFile"))},[o]);return e.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(d,{size:18})," ",o("import.importTitle")]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(x,{size:18})})]}),e.jsxs("div",{onDragOver:e=>{e.preventDefault(),C(!0)},onDragLeave:()=>C(!1),onDrop:K,onClick:()=>i.current?.click(),className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all "+(k?"border-primary-500 bg-primary-50":c?"border-green-400 bg-green-50":"border-gray-300 bg-white hover:border-gray-400"),children:[e.jsx("input",{ref:i,type:"file",accept:".xlsx,.csv",onChange:e=>{const t=e.target.files?.[0];t&&(n(t),v(null)),e.target.value=""},className:"hidden"}),c?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(p,{className:"text-green-600",size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-green-800",children:c.name}),e.jsxs("p",{className:"text-xs text-green-600",children:[(c.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),n(null),v(null)},className:"ml-4 p-1 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-50",children:e.jsx(x,{size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mx-auto text-gray-400 mb-2",size:32}),e.jsxs("p",{className:"text-gray-600",children:[o("import.dragDrop")," ",e.jsx("span",{className:"text-primary-600 font-medium",children:o("import.browse")})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:o("import.fileTypes")})]})]}),c&&!w&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2 uppercase",children:o("import.modeLabel")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer text-sm transition-all "+("merge"===m?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 bg-white hover:border-gray-300"),children:[e.jsx("input",{type:"radio",name:"mode",value:"merge",checked:"merge"===m,onChange:()=>g("merge"),className:"sr-only"}),e.jsx("span",{className:"w-3 h-3 rounded-full border-2 flex-shrink-0 "+("merge"===m?"border-primary-500 bg-primary-500":"border-gray-300"),style:"merge"===m?{boxShadow:"inset 0 0 0 2px white"}:{}}),o("import.modeMerge")]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer text-sm transition-all "+("replace"===m?"border-red-500 bg-red-50 text-red-700":"border-gray-200 bg-white hover:border-gray-300"),children:[e.jsx("input",{type:"radio",name:"mode",value:"replace",checked:"replace"===m,onChange:()=>g("replace"),className:"sr-only"}),e.jsx("span",{className:"w-3 h-3 rounded-full border-2 flex-shrink-0 "+("replace"===m?"border-red-500 bg-red-500":"border-gray-300"),style:"replace"===m?{boxShadow:"inset 0 0 0 2px white"}:{}}),o("import.modeReplace")]})]}),"replace"===m&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(u,{size:12})," ",o("import.replaceWarning")]})]}),e.jsx("button",{onClick:async()=>{if(c){N(!0),v(null);try{const e=await r.upload(`/import/${s}`,c,{mode:m});v(e),0===e?.righeErrore?h.success(`${o("import.importSuccess")}: ${e.righeImportate}/${e.totaleRighe}`):h.error(`${e.righeErrore} ${o("import.errors").toLowerCase()}`)}catch{h.error(o("common.error"))}N(!1)}},disabled:b,className:"btn-success flex items-center gap-2 text-sm whitespace-nowrap",children:b?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"animate-spin",size:15})," ",o("import.importing")]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{size:15})," ",o("import.importBtn")]})})]}),w&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg "+(0===w.righeErrore?"bg-green-50 text-green-800":"bg-yellow-50 text-yellow-800"),children:[0===w.righeErrore?e.jsx(j,{size:20,className:"text-green-600"}):e.jsx(u,{size:20,className:"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o("import.resultTitle")}),e.jsx("p",{className:"text-sm",children:o("import.resultSummary",{imported:w.righeImportate,total:w.totaleRighe,errors:w.righeErrore})})]})]}),w.errori?.length>0&&e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 max-h-48 overflow-y-auto",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 mb-2",children:o("import.errorDetails")}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-red-600",children:[e.jsx("th",{className:"text-left py-1 px-2",children:o("import.errorRow")}),e.jsx("th",{className:"text-left py-1 px-2",children:o("import.errorField")}),e.jsx("th",{className:"text-left py-1 px-2",children:o("import.errorMessage")})]})}),e.jsx("tbody",{children:w.errori.map((t,r)=>e.jsxs("tr",{className:"border-t border-red-100",children:[e.jsx("td",{className:"py-1 px-2 font-mono",children:t.riga}),e.jsx("td",{className:"py-1 px-2",children:t.campo}),e.jsx("td",{className:"py-1 px-2 text-red-600",children:t.messaggio})]},r))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{n(null),v(null)},className:"btn-secondary text-sm",children:o("import.importAnother")}),e.jsx("button",{onClick:a,className:"btn-primary text-sm",children:o("import.done")})]})]})]})}export{k as default};
========
import{j as e}from"./vendor-three-CHCIWYOy.js";import{r as t}from"./vendor-react-DmByJA4P.js";import{a as r}from"./index-DphahvmJ.js";import{u as s}from"./formatters-BFOEvdlG.js";import{P as a,a2 as l,U as o,a3 as i,m as c,a4 as n,D as m,a as d,a5 as p,X as x,R as y,C as g,o as b,z as h,v as u,a6 as j}from"./vendor-ui-CwcPvQqL.js";import{u as f}from"./vendor-i18n-BveTNVnu.js";const N=[{key:"prodotti",icon:a,labelKey:"import.products"},{key:"prezzi",icon:l,labelKey:"import.prices"},{key:"clienti",icon:o,labelKey:"import.clients"},{key:"puntivendita",icon:i,labelKey:"import.branches"}],w={prodotti:[{key:"prdCod",labelKey:"import.col.code",w:"w-32"},{key:"prdDes",labelKey:"import.col.description",w:"flex-1"},{key:"prdUm",labelKey:"import.col.um",w:"w-20"},{key:"catCod",labelKey:"import.col.category",w:"w-28"},{key:"famCod",labelKey:"import.col.family",w:"w-28"},{key:"grpCod",labelKey:"import.col.group",w:"w-28"},{key:"cfgTipo",labelKey:"import.col.configuration",w:"w-28"},{key:"cfgColore",labelKey:"import.col.color",w:"w-20"}],prezzi:[{key:"prdCod",labelKey:"import.col.productCode",w:"flex-1"},{key:"lstCod",labelKey:"import.col.priceListCode",w:"flex-1"},{key:"prdPrz",labelKey:"import.col.price",w:"w-32",format:"price"}],clienti:[{key:"itemID",labelKey:"import.col.code",w:"w-28"},{key:"itemDes",labelKey:"import.col.companyName",w:"flex-1"},{key:"pIva",labelKey:"import.col.vatNumber",w:"w-36"},{key:"cFis",labelKey:"import.col.taxCode",w:"w-36"},{key:"ind",labelKey:"import.col.address",w:"w-40"},{key:"loc",labelKey:"import.col.city",w:"w-28"},{key:"pro",labelKey:"import.col.province",w:"w-16"},{key:"lstCod",labelKey:"import.col.priceList",w:"w-28"},{key:"pagCod",labelKey:"import.col.payment",w:"w-24"}],puntivendita:[{key:"itemID",labelKey:"import.col.customer",w:"w-24"},{key:"itemIDSede",labelKey:"import.col.branch",w:"w-24"},{key:"itemDes",labelKey:"import.col.description",w:"flex-1"},{key:"loc",labelKey:"import.col.city",w:"w-32"},{key:"pro",labelKey:"import.col.province",w:"w-16"},{key:"tel",labelKey:"import.col.phone",w:"w-32"},{key:"mail",labelKey:"import.col.email",w:"w-40"}]},v={prodotti:"PrdCod | PrdDes | PrdUm | PosArc | PrvCla | SitCod | GrpCod | CatCod | TreeCod | FamCod | DiBaCod | CfgTipo | CfgColore | PrdDes_EN | PrdDes_FR | PrdDes_DE",prezzi:"PrdCod | LstCod | PrdPrz",clienti:"ItemID | ItemDes | PIva | CFis | Ind | Cap | Loc | Pro | LstCod | LstCodPubb | PagCod",puntivendita:"ItemID | ItemIDSede | ItemDes | Ind | Cap | Loc | Pro | Reg | Naz | LstCod | LstCodPubb | PagCod | Tel | Mail"};function k(){const{t:s}=f(),[a,l]=t.useState("prodotti"),[o,i]=t.useState({prodotti:0,prezzi:0,clienti:0,puntivendita:0}),[c,n]=t.useState(!0);t.useEffect(()=>{m()},[]);const m=async()=>{n(!0);const e=await r.get("/import/counts");e?.success&&i(e.data),n(!1)};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("import.title")})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:N.map(t=>e.jsx("div",{className:"card p-4 cursor-pointer transition-all "+(a===t.key?"ring-2 ring-primary-500 bg-primary-50":"hover:shadow-md"),onClick:()=>l(t.key),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+(a===t.key?"bg-primary-100 text-primary-600":"bg-gray-100 text-gray-500"),children:e.jsx(t.icon,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:s(t.labelKey)}),e.jsx("p",{className:"text-xl font-bold "+(c?"text-gray-300":""),children:o[t.key]??0})]})]})},t.key))}),e.jsx("div",{className:"flex gap-1 mb-6 overflow-x-auto border-b border-gray-200",children:N.map(t=>e.jsxs("button",{onClick:()=>l(t.key),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap "+(a===t.key?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(t.icon,{size:16}),s(t.labelKey)]},t.key))}),e.jsx(C,{tabKey:a,onImportDone:m})]})}function C({tabKey:a,onImportDone:l}){const{t:o}=f(),i=s(),[u,j]=t.useState([]),[N,k]=t.useState(!0),[C,z]=t.useState(""),[D,P]=t.useState(1),[S,I]=t.useState(null),[L,R]=t.useState(!1),[E,F]=t.useState(!1);t.useEffect(()=>{z(""),P(1),R(!1),F(!1),j([]),I(null),$(a,1,"")},[a]);const $=async(e,t,s)=>{k(!0);const a=new URLSearchParams({page:String(t),pageSize:"10"});s&&a.set("search",s);const l=await r.get(`/import/${e}?${a}`);l?.success&&(j(l.data),I(l.pagination)),k(!1)},T=e=>{P(e),$(a,e,C)},U=w[a]||[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("form",{onSubmit:e=>{e.preventDefault(),P(1),$(a,1,C)},className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-72",children:[e.jsx(c,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",value:C,onChange:e=>z(e.target.value),placeholder:o("import.searchPlaceholder"),className:"input-field pl-10 text-sm"})]}),e.jsx("button",{type:"submit",className:"btn-primary text-sm",children:o("import.searchBtn")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>F(!E),className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(n,{size:15})," ",o("import.template")]}),e.jsxs("button",{onClick:async()=>{h.loading(o("import.exporting"),{id:"export"});const e=await r.downloadBlob(`/import/${a}/export`);if(e){const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`${a}_export.xlsx`,r.click(),URL.revokeObjectURL(t),h.success(o("import.exportDone"),{id:"export"})}else h.error(o("common.error"),{id:"export"})},className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(m,{size:15})," ",o("import.exportBtn")]}),e.jsxs("button",{onClick:()=>R(!L),className:"btn-primary flex items-center gap-1.5 text-sm",children:[e.jsx(d,{size:15})," ",o("import.importBtn")]})]})]}),E&&e.jsx("div",{className:"card bg-blue-50 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(p,{size:20,className:"text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-blue-900 text-sm mb-1",children:o("import.templateTitle")}),e.jsx("p",{className:"text-xs text-blue-700 font-mono break-all",children:v[a]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:o("import.templateNote")})]}),e.jsx("button",{onClick:()=>F(!1),className:"text-blue-400 hover:text-blue-600",children:e.jsx(x,{size:16})})]})}),L&&e.jsx(K,{tabKey:a,onDone:()=>{R(!1),z(""),P(1),$(a,1,""),l?.()},onCancel:()=>R(!1)}),e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50 text-left text-gray-600 border-b",children:U.map(t=>e.jsx("th",{className:"px-4 py-3 font-medium whitespace-nowrap",children:o(t.labelKey)},t.key))})}),e.jsx("tbody",{children:N?e.jsx("tr",{children:e.jsxs("td",{colSpan:U.length,className:"text-center py-12 text-gray-400",children:[e.jsx(y,{className:"animate-spin inline mr-2",size:16}),o("app.loading")]})}):0===u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:U.length,className:"text-center py-12 text-gray-400",children:o("common.noData")})}):u.map((t,r)=>e.jsx("tr",{className:"border-t hover:bg-gray-50 transition-colors",children:U.map(r=>e.jsx("td",{className:"px-4 py-2.5 text-gray-700",children:"price"===r.format&&null!=t[r.key]?i.currency(t[r.key]):t[r.key]??"—"},r.key))},r))})]})}),S&&S.total>0&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:o("import.showing",{from:(S.page-1)*S.pageSize+1,to:Math.min(S.page*S.pageSize,S.total),total:S.total})}),S.totalPages>1&&e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>T(Math.max(1,D-1)),disabled:D<=1,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(g,{size:18})}),Array.from({length:Math.min(5,S.totalPages)},(t,r)=>{let s;return s=S.totalPages<=5||D<=3?r+1:D>=S.totalPages-2?S.totalPages-4+r:D-2+r,e.jsx("button",{onClick:()=>T(s),className:"px-3 py-1 rounded text-sm "+(D===s?"bg-primary-600 text-white":"hover:bg-gray-200 text-gray-600"),children:s},s)}),e.jsx("button",{onClick:()=>T(Math.min(S.totalPages,D+1)),disabled:D>=S.totalPages,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(b,{size:18})})]})]})]})]})}function K({tabKey:s,onDone:a,onCancel:l}){const{t:o}=f(),i=t.useRef(null),[c,n]=t.useState(null),[m,g]=t.useState("merge"),[b,N]=t.useState(!1),[w,v]=t.useState(null),[k,C]=t.useState(!1),K=t.useCallback(e=>{e.preventDefault(),C(!1);const t=e.dataTransfer?.files?.[0];t&&(t.name.endsWith(".xlsx")||t.name.endsWith(".csv"))?(n(t),v(null)):h.error(o("import.invalidFile"))},[o]);return e.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(d,{size:18})," ",o("import.importTitle")]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(x,{size:18})})]}),e.jsxs("div",{onDragOver:e=>{e.preventDefault(),C(!0)},onDragLeave:()=>C(!1),onDrop:K,onClick:()=>i.current?.click(),className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all "+(k?"border-primary-500 bg-primary-50":c?"border-green-400 bg-green-50":"border-gray-300 bg-white hover:border-gray-400"),children:[e.jsx("input",{ref:i,type:"file",accept:".xlsx,.csv",onChange:e=>{const t=e.target.files?.[0];t&&(n(t),v(null)),e.target.value=""},className:"hidden"}),c?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(p,{className:"text-green-600",size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-green-800",children:c.name}),e.jsxs("p",{className:"text-xs text-green-600",children:[(c.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),n(null),v(null)},className:"ml-4 p-1 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-50",children:e.jsx(x,{size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"mx-auto text-gray-400 mb-2",size:32}),e.jsxs("p",{className:"text-gray-600",children:[o("import.dragDrop")," ",e.jsx("span",{className:"text-primary-600 font-medium",children:o("import.browse")})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:o("import.fileTypes")})]})]}),c&&!w&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2 uppercase",children:o("import.modeLabel")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer text-sm transition-all "+("merge"===m?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 bg-white hover:border-gray-300"),children:[e.jsx("input",{type:"radio",name:"mode",value:"merge",checked:"merge"===m,onChange:()=>g("merge"),className:"sr-only"}),e.jsx("span",{className:"w-3 h-3 rounded-full border-2 flex-shrink-0 "+("merge"===m?"border-primary-500 bg-primary-500":"border-gray-300"),style:"merge"===m?{boxShadow:"inset 0 0 0 2px white"}:{}}),o("import.modeMerge")]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer text-sm transition-all "+("replace"===m?"border-red-500 bg-red-50 text-red-700":"border-gray-200 bg-white hover:border-gray-300"),children:[e.jsx("input",{type:"radio",name:"mode",value:"replace",checked:"replace"===m,onChange:()=>g("replace"),className:"sr-only"}),e.jsx("span",{className:"w-3 h-3 rounded-full border-2 flex-shrink-0 "+("replace"===m?"border-red-500 bg-red-500":"border-gray-300"),style:"replace"===m?{boxShadow:"inset 0 0 0 2px white"}:{}}),o("import.modeReplace")]})]}),"replace"===m&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(u,{size:12})," ",o("import.replaceWarning")]})]}),e.jsx("button",{onClick:async()=>{if(c){N(!0),v(null);try{const e=await r.upload(`/import/${s}`,c,{mode:m});v(e),0===e?.righeErrore?h.success(`${o("import.importSuccess")}: ${e.righeImportate}/${e.totaleRighe}`):h.error(`${e.righeErrore} ${o("import.errors").toLowerCase()}`)}catch{h.error(o("common.error"))}N(!1)}},disabled:b,className:"btn-success flex items-center gap-2 text-sm whitespace-nowrap",children:b?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"animate-spin",size:15})," ",o("import.importing")]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{size:15})," ",o("import.importBtn")]})})]}),w&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg "+(0===w.righeErrore?"bg-green-50 text-green-800":"bg-yellow-50 text-yellow-800"),children:[0===w.righeErrore?e.jsx(j,{size:20,className:"text-green-600"}):e.jsx(u,{size:20,className:"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:o("import.resultTitle")}),e.jsx("p",{className:"text-sm",children:o("import.resultSummary",{imported:w.righeImportate,total:w.totaleRighe,errors:w.righeErrore})})]})]}),w.errori?.length>0&&e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 max-h-48 overflow-y-auto",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 mb-2",children:o("import.errorDetails")}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-red-600",children:[e.jsx("th",{className:"text-left py-1 px-2",children:o("import.errorRow")}),e.jsx("th",{className:"text-left py-1 px-2",children:o("import.errorField")}),e.jsx("th",{className:"text-left py-1 px-2",children:o("import.errorMessage")})]})}),e.jsx("tbody",{children:w.errori.map((t,r)=>e.jsxs("tr",{className:"border-t border-red-100",children:[e.jsx("td",{className:"py-1 px-2 font-mono",children:t.riga}),e.jsx("td",{className:"py-1 px-2",children:t.campo}),e.jsx("td",{className:"py-1 px-2 text-red-600",children:t.messaggio})]},r))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{n(null),v(null)},className:"btn-secondary text-sm",children:o("import.importAnother")}),e.jsx("button",{onClick:a,className:"btn-primary text-sm",children:o("import.done")})]})]})]})}export{k as default};
>>>>>>>> f38ac08e382144f952ab278c2ba76b3c3b706f83:recinzioni-portal/backend/RecinzioniPortal.API/publish/wwwroot/assets/ImportPage-DmnVRcyr.js
