import{j as e}from"./vendor-three-CHCIWYOy.js";import{r as t}from"./vendor-react-DmByJA4P.js";import{a as r}from"./index-BmUX95Px.js";import{u as s}from"./formatters-BFOEvdlG.js";import{P as a,a2 as l,U as i,a3 as o,m as n,a4 as c,D as d,a as m,a5 as x,X as p,R as g,C as b,o as h,z as y,v as u,a6 as j}from"./vendor-ui-CwcPvQqL.js";import{u as f}from"./vendor-i18n-BveTNVnu.js";const w=[{key:"prodotti",icon:a,labelKey:"import.products"},{key:"prezzi",icon:l,labelKey:"import.prices"},{key:"clienti",icon:i,labelKey:"import.clients"},{key:"puntivendita",icon:o,labelKey:"import.branches"}],N={prodotti:[{key:"prdCod",label:"Codice",w:"w-32"},{key:"prdDes",label:"Descrizione",w:"flex-1"},{key:"prdUm",label:"U.M.",w:"w-20"},{key:"catCod",label:"Categoria",w:"w-28"},{key:"famCod",label:"Famiglia",w:"w-28"},{key:"grpCod",label:"Gruppo",w:"w-28"},{key:"cfgTipo",label:"Configurazione",w:"w-28"},{key:"cfgColore",label:"Colore",w:"w-20"}],prezzi:[{key:"prdCod",label:"Codice Prodotto",w:"flex-1"},{key:"lstCod",label:"Codice Listino",w:"flex-1"},{key:"prdPrz",label:"Prezzo",w:"w-32",format:"price"}],clienti:[{key:"itemID",label:"Codice",w:"w-28"},{key:"itemDes",label:"Ragione Sociale",w:"flex-1"},{key:"pIva",label:"P.IVA",w:"w-36"},{key:"cFis",label:"C.F.",w:"w-36"},{key:"ind",label:"Indirizzo",w:"w-40"},{key:"loc",label:"Località",w:"w-28"},{key:"pro",label:"Prov.",w:"w-16"},{key:"lstCod",label:"Listino",w:"w-28"},{key:"pagCod",label:"Pagamento",w:"w-24"}],puntivendita:[{key:"itemID",label:"Cliente",w:"w-24"},{key:"itemIDSede",label:"Sede",w:"w-24"},{key:"itemDes",label:"Descrizione",w:"flex-1"},{key:"loc",label:"Località",w:"w-32"},{key:"pro",label:"Prov.",w:"w-16"},{key:"tel",label:"Telefono",w:"w-32"},{key:"mail",label:"Email",w:"w-40"}]},v={prodotti:"PrdCod | PrdDes | PrdUm | PosArc | PrvCla | SitCod | GrpCod | CatCod | TreeCod | FamCod | DiBaCod | CfgTipo | CfgColore | PrdDes_EN | PrdDes_FR | PrdDes_DE",prezzi:"PrdCod | LstCod | PrdPrz",clienti:"ItemID | ItemDes | PIva | CFis | Ind | Cap | Loc | Pro | LstCod | LstCodPubb | PagCod",puntivendita:"ItemID | ItemIDSede | ItemDes | Ind | Cap | Loc | Pro | Reg | Naz | LstCod | LstCodPubb | PagCod | Tel | Mail"};function k(){const{t:s}=f(),[a,l]=t.useState("prodotti"),[i,o]=t.useState({prodotti:0,prezzi:0,clienti:0,puntivendita:0}),[n,c]=t.useState(!0);t.useEffect(()=>{d()},[]);const d=async()=>{c(!0);const e=await r.get("/import/counts");e?.success&&o(e.data),c(!1)};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s("import.title")})}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:w.map(t=>e.jsx("div",{className:"card p-4 cursor-pointer transition-all "+(a===t.key?"ring-2 ring-primary-500 bg-primary-50":"hover:shadow-md"),onClick:()=>l(t.key),children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg "+(a===t.key?"bg-primary-100 text-primary-600":"bg-gray-100 text-gray-500"),children:e.jsx(t.icon,{size:20})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase",children:s(t.labelKey)}),e.jsx("p",{className:"text-xl font-bold "+(n?"text-gray-300":""),children:i[t.key]??0})]})]})},t.key))}),e.jsx("div",{className:"flex gap-1 mb-6 overflow-x-auto border-b border-gray-200",children:w.map(t=>e.jsxs("button",{onClick:()=>l(t.key),className:"flex items-center gap-2 px-4 py-3 text-sm font-medium border-b-2 transition-colors whitespace-nowrap "+(a===t.key?"border-primary-600 text-primary-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[e.jsx(t.icon,{size:16}),s(t.labelKey)]},t.key))}),e.jsx(C,{tabKey:a,onImportDone:d})]})}function C({tabKey:a,onImportDone:l}){const{t:i}=f(),o=s(),[u,j]=t.useState([]),[w,k]=t.useState(!0),[C,P]=t.useState(""),[D,S]=t.useState(1),[I,L]=t.useState(null),[R,F]=t.useState(!1),[E,K]=t.useState(!1);t.useEffect(()=>{P(""),S(1),F(!1),K(!1),j([]),L(null),T(a,1,"")},[a]);const T=async(e,t,s)=>{k(!0);const a=new URLSearchParams({page:String(t),pageSize:"50"});s&&a.set("search",s);const l=await r.get(`/import/${e}?${a}`);l?.success&&(j(l.data),L(l.pagination)),k(!1)},$=e=>{S(e),T(a,e,C)},U=N[a]||[];return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("form",{onSubmit:e=>{e.preventDefault(),S(1),T(a,1,C)},className:"flex gap-2 w-full sm:w-auto",children:[e.jsxs("div",{className:"relative flex-1 sm:w-72",children:[e.jsx(n,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",value:C,onChange:e=>P(e.target.value),placeholder:i("import.searchPlaceholder"),className:"input-field pl-10 text-sm"})]}),e.jsx("button",{type:"submit",className:"btn-primary text-sm",children:i("import.searchBtn")})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>K(!E),className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(c,{size:15})," ",i("import.template")]}),e.jsxs("button",{onClick:async()=>{y.loading(i("import.exporting"),{id:"export"});const e=await r.downloadBlob(`/import/${a}/export`);if(e){const t=URL.createObjectURL(e),r=document.createElement("a");r.href=t,r.download=`${a}_export.xlsx`,r.click(),URL.revokeObjectURL(t),y.success(i("import.exportDone"),{id:"export"})}else y.error(i("common.error"),{id:"export"})},className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(d,{size:15})," ",i("import.exportBtn")]}),e.jsxs("button",{onClick:()=>F(!R),className:"btn-primary flex items-center gap-1.5 text-sm",children:[e.jsx(m,{size:15})," ",i("import.importBtn")]})]})]}),E&&e.jsx("div",{className:"card bg-blue-50 border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{size:20,className:"text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-blue-900 text-sm mb-1",children:i("import.templateTitle")}),e.jsx("p",{className:"text-xs text-blue-700 font-mono break-all",children:v[a]}),e.jsx("p",{className:"text-xs text-blue-600 mt-2",children:i("import.templateNote")})]}),e.jsx("button",{onClick:()=>K(!1),className:"text-blue-400 hover:text-blue-600",children:e.jsx(p,{size:16})})]})}),R&&e.jsx(z,{tabKey:a,onDone:()=>{F(!1),P(""),S(1),T(a,1,""),l?.()},onCancel:()=>F(!1)}),e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-gray-50 text-left text-gray-600 border-b",children:U.map(t=>e.jsx("th",{className:"px-4 py-3 font-medium whitespace-nowrap",children:t.label},t.key))})}),e.jsx("tbody",{children:w?e.jsx("tr",{children:e.jsxs("td",{colSpan:U.length,className:"text-center py-12 text-gray-400",children:[e.jsx(g,{className:"animate-spin inline mr-2",size:16}),i("app.loading")]})}):0===u.length?e.jsx("tr",{children:e.jsx("td",{colSpan:U.length,className:"text-center py-12 text-gray-400",children:i("common.noData")})}):u.map((t,r)=>e.jsx("tr",{className:"border-t hover:bg-gray-50 transition-colors",children:U.map(r=>e.jsx("td",{className:"px-4 py-2.5 text-gray-700",children:"price"===r.format&&null!=t[r.key]?o.currency(t[r.key]):t[r.key]??"—"},r.key))},r))})]})}),I&&I.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:i("import.showing",{from:(I.page-1)*I.pageSize+1,to:Math.min(I.page*I.pageSize,I.total),total:I.total})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>$(Math.max(1,D-1)),disabled:D<=1,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(b,{size:18})}),Array.from({length:Math.min(5,I.totalPages)},(t,r)=>{let s;return s=I.totalPages<=5||D<=3?r+1:D>=I.totalPages-2?I.totalPages-4+r:D-2+r,e.jsx("button",{onClick:()=>$(s),className:"px-3 py-1 rounded text-sm "+(D===s?"bg-primary-600 text-white":"hover:bg-gray-200 text-gray-600"),children:s},s)}),e.jsx("button",{onClick:()=>$(Math.min(I.totalPages,D+1)),disabled:D>=I.totalPages,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(h,{size:18})})]})]})]})]})}function z({tabKey:s,onDone:a,onCancel:l}){const{t:i}=f(),o=t.useRef(null),[n,c]=t.useState(null),[d,b]=t.useState("merge"),[h,w]=t.useState(!1),[N,v]=t.useState(null),[k,C]=t.useState(!1),z=t.useCallback(e=>{e.preventDefault(),C(!1);const t=e.dataTransfer?.files?.[0];t&&(t.name.endsWith(".xlsx")||t.name.endsWith(".csv"))?(c(t),v(null)):y.error(i("import.invalidFile"))},[i]);return e.jsxs("div",{className:"card border-2 border-primary-200 bg-primary-50/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold text-gray-700 flex items-center gap-2",children:[e.jsx(m,{size:18})," ",i("import.importTitle")]}),e.jsx("button",{onClick:l,className:"text-gray-400 hover:text-gray-600",children:e.jsx(p,{size:18})})]}),e.jsxs("div",{onDragOver:e=>{e.preventDefault(),C(!0)},onDragLeave:()=>C(!1),onDrop:z,onClick:()=>o.current?.click(),className:"border-2 border-dashed rounded-xl p-8 text-center cursor-pointer transition-all "+(k?"border-primary-500 bg-primary-50":n?"border-green-400 bg-green-50":"border-gray-300 bg-white hover:border-gray-400"),children:[e.jsx("input",{ref:o,type:"file",accept:".xlsx,.csv",onChange:e=>{const t=e.target.files?.[0];t&&(c(t),v(null)),e.target.value=""},className:"hidden"}),n?e.jsxs("div",{className:"flex items-center justify-center gap-3",children:[e.jsx(x,{className:"text-green-600",size:24}),e.jsxs("div",{className:"text-left",children:[e.jsx("p",{className:"font-medium text-green-800",children:n.name}),e.jsxs("p",{className:"text-xs text-green-600",children:[(n.size/1024).toFixed(1)," KB"]})]}),e.jsx("button",{onClick:e=>{e.stopPropagation(),c(null),v(null)},className:"ml-4 p-1 text-gray-400 hover:text-red-500 rounded-full hover:bg-red-50",children:e.jsx(p,{size:16})})]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"mx-auto text-gray-400 mb-2",size:32}),e.jsxs("p",{className:"text-gray-600",children:[i("import.dragDrop")," ",e.jsx("span",{className:"text-primary-600 font-medium",children:i("import.browse")})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:i("import.fileTypes")})]})]}),n&&!N&&e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4 mt-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs font-medium text-gray-500 mb-2 uppercase",children:i("import.modeLabel")}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer text-sm transition-all "+("merge"===d?"border-primary-500 bg-primary-50 text-primary-700":"border-gray-200 bg-white hover:border-gray-300"),children:[e.jsx("input",{type:"radio",name:"mode",value:"merge",checked:"merge"===d,onChange:()=>b("merge"),className:"sr-only"}),e.jsx("span",{className:"w-3 h-3 rounded-full border-2 flex-shrink-0 "+("merge"===d?"border-primary-500 bg-primary-500":"border-gray-300"),style:"merge"===d?{boxShadow:"inset 0 0 0 2px white"}:{}}),i("import.modeMerge")]}),e.jsxs("label",{className:"flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer text-sm transition-all "+("replace"===d?"border-red-500 bg-red-50 text-red-700":"border-gray-200 bg-white hover:border-gray-300"),children:[e.jsx("input",{type:"radio",name:"mode",value:"replace",checked:"replace"===d,onChange:()=>b("replace"),className:"sr-only"}),e.jsx("span",{className:"w-3 h-3 rounded-full border-2 flex-shrink-0 "+("replace"===d?"border-red-500 bg-red-500":"border-gray-300"),style:"replace"===d?{boxShadow:"inset 0 0 0 2px white"}:{}}),i("import.modeReplace")]})]}),"replace"===d&&e.jsxs("p",{className:"text-xs text-red-500 mt-1 flex items-center gap-1",children:[e.jsx(u,{size:12})," ",i("import.replaceWarning")]})]}),e.jsx("button",{onClick:async()=>{if(n){w(!0),v(null);try{const e=await r.upload(`/import/${s}`,n,{mode:d});v(e),0===e?.righeErrore?y.success(`${i("import.importSuccess")}: ${e.righeImportate}/${e.totaleRighe}`):y.error(`${e.righeErrore} ${i("import.errors").toLowerCase()}`)}catch{y.error(i("common.error"))}w(!1)}},disabled:h,className:"btn-success flex items-center gap-2 text-sm whitespace-nowrap",children:h?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"animate-spin",size:15})," ",i("import.importing")]}):e.jsxs(e.Fragment,{children:[e.jsx(m,{size:15})," ",i("import.importBtn")]})})]}),N&&e.jsxs("div",{className:"mt-4 space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3 p-3 rounded-lg "+(0===N.righeErrore?"bg-green-50 text-green-800":"bg-yellow-50 text-yellow-800"),children:[0===N.righeErrore?e.jsx(j,{size:20,className:"text-green-600"}):e.jsx(u,{size:20,className:"text-yellow-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:i("import.resultTitle")}),e.jsx("p",{className:"text-sm",children:i("import.resultSummary",{imported:N.righeImportate,total:N.totaleRighe,errors:N.righeErrore})})]})]}),N.errori?.length>0&&e.jsxs("div",{className:"bg-red-50 rounded-lg p-3 max-h-48 overflow-y-auto",children:[e.jsx("p",{className:"text-xs font-medium text-red-700 mb-2",children:i("import.errorDetails")}),e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-red-600",children:[e.jsx("th",{className:"text-left py-1 px-2",children:i("import.errorRow")}),e.jsx("th",{className:"text-left py-1 px-2",children:i("import.errorField")}),e.jsx("th",{className:"text-left py-1 px-2",children:i("import.errorMessage")})]})}),e.jsx("tbody",{children:N.errori.map((t,r)=>e.jsxs("tr",{className:"border-t border-red-100",children:[e.jsx("td",{className:"py-1 px-2 font-mono",children:t.riga}),e.jsx("td",{className:"py-1 px-2",children:t.campo}),e.jsx("td",{className:"py-1 px-2 text-red-600",children:t.messaggio})]},r))})]})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{onClick:()=>{c(null),v(null)},className:"btn-secondary text-sm",children:i("import.importAnother")}),e.jsx("button",{onClick:a,className:"btn-primary text-sm",children:i("import.done")})]})]})]})}export{k as default};
