<<<<<<<< HEAD:recinzioni-portal/backend/RecinzioniPortal.API/publish/wwwroot/assets/ConfiguratorPage-DCyTl8k1.js
import{j as e,C as t,O as s,a,G as r,T as n}from"./vendor-three-CHCIWYOy.js";import{r as o,c as i,u as l}from"./vendor-react-DmByJA4P.js";import{p as c,z as d,q as x,B as m,E as h,r as g,s as u,F as p,t as f,o as j,g as b,A as y,f as v,u as N,v as z,w as k,x as w,i as S,C,S as M,y as P,H as D}from"./vendor-ui-CwcPvQqL.js";import{c as B,a as E}from"./index-C9K4tF-I.js";import{u as L}from"./formatters-BFOEvdlG.js";import{u as W}from"./vendor-i18n-BveTNVnu.js";const T=.06,$=.06,I=.04,A=.01,G={100:{persiana:8,pieno:9},150:{persiana:12,pieno:14},185:{persiana:15,pieno:17},200:{persiana:16,pieno:18}};function R({position:t,altezza:s,colore:a,isSelected:r,onClick:n}){const i=o.useRef(),l=s*A;return e.jsxs("group",{position:t,children:[e.jsxs("mesh",{ref:i,position:[0,l/2,0],onClick:n,castShadow:!0,children:[e.jsx("boxGeometry",{args:[T,l,$]}),e.jsx("meshStandardMaterial",{color:a,roughness:.7,metalness:.1})]}),[-1,1].map(t=>e.jsxs("mesh",{position:[t*T*.35,l/2,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.005,l-.02,.062]}),e.jsx("meshStandardMaterial",{color:a,roughness:.5,metalness:.15})]},t)),e.jsxs("mesh",{position:[0,l+.015,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.075,.03,.075]}),e.jsx("meshStandardMaterial",{color:a,roughness:.4,metalness:.2})]}),r&&e.jsxs("mesh",{position:[0,l+.08,0],children:[e.jsx("sphereGeometry",{args:[.02,16,16]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",emissive:"#3b82f6",emissiveIntensity:.5})]}),e.jsxs("mesh",{position:[0,.005,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.09,.01,.09]}),e.jsx("meshStandardMaterial",{color:"#555555",roughness:.9,metalness:.3})]})]})}function F({position:t,lunghezza:s,colore:a,isPersiana:r,rotation:n=[0,0,0]}){const o=s*A,i=r?.25:0;return e.jsxs("mesh",{position:t,rotation:[i,n[1],n[2]],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[o-T,I,.02]}),e.jsx("meshStandardMaterial",{color:a,roughness:.65,metalness:.05})]})}function V({startPos:t,endPos:s,altezza:a,tipoDoghe:r,coloreDoghe:n,numDoghe:i}){const l="persiana"===r,c=l?.03:.002,d=a*A,x=(t[0]+s[0])/2,m=(t[2]+s[2])/2,h=s[0]-t[0],g=s[2]-t[2],u=Math.sqrt(h*h+g*g)/A,p=Math.atan2(g,h),f=o.useMemo(()=>{const e=[],t=(d-(i*I+(i-1)*c))/2+.02+.02;for(let s=0;s<i;s++)e.push(t+s*(I+c));return e},[i,d,c]);return e.jsx("group",{children:f.map((t,s)=>e.jsx(F,{position:[x,t,m],lunghezza:u,colore:n,isPersiana:l,rotation:[0,p,0]},s))})}function X(){return e.jsxs("group",{children:[e.jsx(r,{args:[20,20],cellSize:.5,cellThickness:.5,cellColor:"#a0a0a0",sectionSize:2.5,sectionThickness:1,sectionColor:"#707070",fadeDistance:15,fadeStrength:1.5,position:[0,0,0]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.001,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[20,20]}),e.jsx("meshStandardMaterial",{color:"#e8e8e0",transparent:!0,opacity:.3})]})]})}function Y({start:t,end:s,label:a,yOffset:r=-.05}){const o=(t[0]+s[0])/2,i=(t[2]+s[2])/2;return e.jsx("group",{children:e.jsx(n,{position:[o,r,i-.1],fontSize:.06,color:"#333333",anchorX:"center",anchorY:"middle",children:a})})}function q({sezioni:t,altezzaPali:r,tipoDoghe:n,coloreDoghe:i,colorePali:l,selectedPaloIndex:c,onPaloClick:d}){const x=o.useMemo(()=>{const e=[[0,0,0]];let s=0;for(const a of t){const t=e[e.length-1];s+=(a.angolo||0)*(Math.PI/180);const r=a.lunghezza*A,n=t[0]+Math.cos(s)*r,o=t[2]+Math.sin(s)*r;e.push([n,0,o])}return e},[t]),m=G[r]?"persiana"===n?G[r].persiana:G[r].pieno:12,h=o.useMemo(()=>{if(0===x.length)return[0,0,0];const e=x.map(e=>e[0]),t=x.map(e=>e[2]);return[(Math.min(...e)+Math.max(...e))/2,r*A/2,(Math.min(...t)+Math.max(...t))/2]},[x,r]);return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("directionalLight",{position:[5,8,5],intensity:1.2,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048}),e.jsx("directionalLight",{position:[-3,5,-3],intensity:.3}),e.jsx(s,{target:h,minDistance:.5,maxDistance:15,maxPolarAngle:Math.PI/2-.05,enableDamping:!0,dampingFactor:.08}),e.jsx(X,{}),e.jsx(a,{position:[0,0,0],opacity:.4,scale:15,blur:2,far:5}),x.map((t,s)=>e.jsx(R,{position:t,altezza:r,colore:l,isSelected:c===s,onClick:e=>{e.stopPropagation(),d?.(s)}},`palo-${s}`)),t.map((t,s)=>e.jsx(V,{startPos:x[s],endPos:x[s+1],altezza:r,tipoDoghe:n,coloreDoghe:i,numDoghe:m},`sez-${s}`)),t.map((t,s)=>e.jsx(Y,{start:x[s],end:x[s+1],label:`${t.lunghezza} cm`},`dim-${s}`))]})}function U({sezioni:s=[],altezzaPali:a=150,tipoDoghe:r="persiana",coloreDoghe:n="#7B7B7B",colorePali:o="#7B7B7B",selectedPaloIndex:i=null,onPaloClick:l,className:c=""}){return e.jsx("div",{className:`w-full h-full min-h-[300px] ${c}`,children:e.jsx(t,{shadows:!0,camera:{position:[3,2.5,3],fov:45,near:.1,far:100},gl:{antialias:!0,alpha:!0},style:{background:"linear-gradient(180deg, #e0eaf5 0%, #f5f5f0 60%)"},children:e.jsx(q,{sezioni:s,altezzaPali:a,tipoDoghe:r,coloreDoghe:n,colorePali:o,selectedPaloIndex:i,onPaloClick:l})})})}function O({sezioni:t=[],colorePali:s="#7B7B7B",coloreDoghe:a="#7B7B7B",selectedPaloIndex:r=null,onPaloClick:n,onAddSezione:i,onRemoveSezione:l,onUpdateSezione:d,className:x=""}){const{t:m}=W(),h=o.useRef(null),[g,u]=o.useState(null),[p,f]=o.useState(!1),[j,b]=o.useState(null),[y,v]=o.useState({width:600,height:350});o.useEffect(()=>{const e=new ResizeObserver(e=>{for(const t of e){const{width:e}=t.contentRect;v({width:Math.max(400,e),height:Math.max(250,Math.min(400,.55*e))})}});return h.current?.parentElement&&e.observe(h.current.parentElement),()=>e.disconnect()},[]);const{paliSVG:N,bounds:z,scale:k}=o.useMemo(()=>{const e=[{x:0,y:0}];let s=0;for(const p of t){const t=e[e.length-1];s+=(p.angolo||0)*(Math.PI/180),e.push({x:t.x+Math.cos(s)*p.lunghezza,y:t.y+Math.sin(s)*p.lunghezza})}const a=e.map(e=>e.x),r=e.map(e=>e.y),n=Math.min(...a),o=Math.max(...a),i=Math.min(...r),l=Math.max(...r),c=o-n||150,d=l-i||50,x=y.width-120,m=y.height-120,h=Math.min(x/c,m/Math.max(d,30),3),g=60+(x-c*h)/2,u=60+(m-d*h)/2;return{paliSVG:e.map(e=>({x:g+(e.x-n)*h,y:u+(e.y-i)*h})),bounds:{minX:n,maxX:o,minY:i,maxY:l,realW:c,realH:d},scale:h}},[t,y]),w=o.useCallback((e,s)=>{s.stopPropagation(),e===N.length-1&&t.length<20?i?.():n?.(e)},[N.length,t.length,i,n]),S=o.useCallback((e,t)=>{0===e||e>=N.length||(t.preventDefault(),f(!0),b(e))},[N.length]),C=o.useCallback(e=>{if(!p||null===j||!h.current)return;const t=h.current.getBoundingClientRect(),s=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,r=s-t.left,n=a-t.top,o=N[j-1],i=r-o.x,l=n-o.y,c=Math.sqrt(i*i+l*l),x=Math.round(Math.max(10,Math.min(150,c/k))),m=Math.atan2(l,i);let g=0;if(j>1){const e=N[j-2],t=N[j-1];g=Math.atan2(t.y-e.y,t.x-e.x)}const u=Math.round(180*(m-g)/Math.PI),f=Math.abs(u)>=45?90:0;d?.(j-1,{lunghezza:x,angolo:f})},[p,j,N,k,d]),M=o.useCallback(()=>{f(!1),b(null)},[]);o.useEffect(()=>{if(p)return window.addEventListener("mousemove",C),window.addEventListener("mouseup",M),window.addEventListener("touchmove",C),window.addEventListener("touchend",M),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",M),window.removeEventListener("touchmove",C),window.removeEventListener("touchend",M)}},[p,C,M]);return e.jsxs("div",{className:`relative ${x}`,children:[e.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-3 text-xs text-gray-500 z-10",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full border-2 border-blue-500 bg-blue-100 inline-block"}),m("configurator.plan.clickToAdd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{size:12}),m("configurator.plan.dragToResize")]})]}),e.jsxs("svg",{ref:h,width:y.width,height:y.height,className:"w-full border border-gray-200 rounded-lg bg-white",style:{cursor:p?"grabbing":"default"},children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"30",height:"30",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 30 0 L 0 0 0 30",fill:"none",stroke:"#f0f0f0",strokeWidth:"0.5"})}),e.jsx("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"6",refX:"4",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#999"})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)",rx:"8"}),e.jsxs("text",{x:y.width/2,y:20,textAnchor:"middle",fontSize:"11",fill:"#888",fontWeight:"500",children:[m("configurator.plan.title")," â€” ",m("configurator.plan.topView")]}),t.map((t,s)=>{const r=N[s],n=N[s+1];return r&&n?e.jsxs("g",{children:[e.jsx("line",{x1:r.x,y1:r.y+2,x2:n.x,y2:n.y+2,stroke:"rgba(0,0,0,0.08)",strokeWidth:12,strokeLinecap:"round"}),e.jsx("line",{x1:r.x,y1:r.y,x2:n.x,y2:n.y,stroke:a,strokeWidth:10,strokeLinecap:"round",opacity:.85}),e.jsx("line",{x1:r.x,y1:r.y,x2:n.x,y2:n.y,stroke:a,strokeWidth:12,strokeLinecap:"round",opacity:.3}),e.jsxs("text",{x:(r.x+n.x)/2,y:(r.y+n.y)/2-20,textAnchor:"middle",fontSize:"12",fontWeight:"600",fill:"#333",className:"select-none pointer-events-none",children:[t.lunghezza," cm"]}),e.jsxs("text",{x:(r.x+n.x)/2,y:(r.y+n.y)/2+20+5,textAnchor:"middle",fontSize:"9",fill:"#888",className:"select-none pointer-events-none",children:[m("configurator.section")," ",s+1]})]},`sez-line-${s}`):null}),t.map((t,s)=>{if(0===s||0===t.angolo)return null;const a=N[s];return a?e.jsxs("g",{children:[e.jsx("circle",{cx:a.x,cy:a.y,r:25,fill:"none",stroke:"#3b82f6",strokeWidth:"1",strokeDasharray:"3,3",opacity:.4}),e.jsxs("text",{x:a.x+25+4,y:a.y-4,fontSize:"10",fill:"#3b82f6",fontWeight:"500",children:[t.angolo,"Â°"]})]},`angle-${s}`):null}),N.map((a,n)=>{const o=r===n,i=g===n,l=(e=>e===N.length-1)(n),c=l&&t.length<20;let d=8;return o&&(d=11),i&&(d=14),e.jsxs("g",{onClick:e=>w(n,e),onMouseDown:e=>S(n,e),onTouchStart:e=>S(n,e),onMouseEnter:()=>u(n),onMouseLeave:()=>u(null),style:{cursor:c?"pointer":n>0?"grab":"default"},children:[i&&e.jsx("circle",{cx:a.x,cy:a.y,r:d+6,fill:c?"rgba(59,130,246,0.1)":"rgba(0,0,0,0.05)",stroke:c?"#3b82f6":"#ccc",strokeWidth:"1",strokeDasharray:c?"none":"3,3"}),e.jsx("circle",{cx:a.x,cy:a.y,r:d,fill:o?"#3b82f6":s,stroke:o?"#1d4ed8":"#555",strokeWidth:o?3:1.5}),c&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:a.x-4,y1:a.y,x2:a.x+4,y2:a.y,stroke:"white",strokeWidth:"2",strokeLinecap:"round",className:"pointer-events-none"}),e.jsx("line",{x1:a.x,y1:a.y-4,x2:a.x,y2:a.y+4,stroke:"white",strokeWidth:"2",strokeLinecap:"round",className:"pointer-events-none"})]}),e.jsxs("text",{x:a.x,y:a.y+d+14,textAnchor:"middle",fontSize:"9",fill:o?"#1d4ed8":"#666",fontWeight:o?"600":"400",className:"select-none pointer-events-none",children:["P",n+1]})]},`palo-${n}`)}),0===t.length&&1===N.length&&e.jsxs("text",{x:N[0].x+30,y:N[0].y,fontSize:"12",fill:"#999",dominantBaseline:"middle",children:["â† ",m("configurator.plan.clickFirstPost")]}),k>0&&e.jsxs("g",{children:[e.jsx("line",{x1:15,y1:y.height-20,x2:15+100*k*.5,y2:y.height-20,stroke:"#999",strokeWidth:"1"}),e.jsxs("text",{x:15+100*k*.5/2,y:y.height-8,textAnchor:"middle",fontSize:"9",fill:"#999",children:[Math.round(50)," cm"]})]})]})]})}const H={100:{persiana:8,pieno:9},150:{persiana:12,pieno:14},185:{persiana:15,pieno:17},200:{persiana:16,pieno:18}},K=[{hex:"#7B7B7B",nome:"Grigio"},{hex:"#2D5A27",nome:"Verde"},{hex:"#8B4513",nome:"Rosso mattone"}],_=[100,150,185,200],J=[{id:"parametri",icon:g},{id:"disegno",icon:u},{id:"riepilogo",icon:p}];function Q({colori:t,value:s,onChange:a,label:r}){return e.jsxs("div",{className:"flex flex-col gap-1.5",children:[r&&e.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r}),e.jsx("div",{className:"flex gap-2",children:t.map(t=>e.jsx("button",{className:"w-10 h-10 rounded-full border-2 transition-all duration-200 hover:scale-110 "+(s===t.hex?"border-blue-500 ring-2 ring-blue-200 scale-110":"border-gray-300 hover:border-gray-400"),style:{backgroundColor:t.hex},onClick:()=>a(t.hex),title:t.nome},t.hex))})]})}function Z({value:t,min:s,max:a,step:r=1,onChange:n,unit:i="cm",label:l}){const[c,d]=o.useState(t);o.useEffect(()=>d(t),[t]);const x=()=>{const e=Math.max(s,Math.min(a,Number(c)||s));d(e),n(e)};return e.jsxs("div",{className:"flex items-center gap-3",children:[l&&e.jsx("span",{className:"text-sm text-gray-600 w-16 shrink-0",children:l}),e.jsx("input",{type:"range",min:s,max:a,step:r,value:c,onChange:e=>{d(Number(e.target.value)),n(Number(e.target.value))},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer bg-gray-200 accent-blue-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:s,max:a,step:r,value:c,onChange:e=>d(e.target.value),onBlur:x,onKeyDown:e=>"Enter"===e.key&&x(),className:"w-16 px-2 py-1 text-sm text-center border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("span",{className:"text-xs text-gray-400",children:i})]})]})}function ee(){const{t:t}=W(),s=i(),a=l(),r=B(e=>e.addConfiguredItem),n=L(),[c,g]=o.useState("recinzione"),[u,T]=o.useState(0),[$,I]=o.useState(!0),[A,G]=o.useState("#7B7B7B"),[R,F]=o.useState("#7B7B7B"),[V,X]=o.useState("cemento"),[Y,q]=o.useState("persiana"),[ee,te]=o.useState(150),[se,ae]=o.useState([{lunghezza:150,angolo:0}]),[re,ne]=o.useState("both"),[oe,ie]=o.useState(null),[le,ce]=o.useState(!1),[de,xe]=o.useState(null),[me,he]=o.useState(!1),[ge,ue]=o.useState(null);o.useEffect(()=>{if(a.state?.fromProduct){const e=a.state.fromProduct;e.cfgTipo&&g(e.cfgTipo),d.success(t("configurator.fromCatalog"))}},[a.state]),o.useEffect(()=>{$&&F(A)},[$,A]),o.useMemo(()=>{const e=H[ee];return e?"persiana"===Y?e.persiana:e.pieno:12},[ee,Y]);const pe=o.useCallback(()=>{se.length>=20?d.error(t("configurator.maxSections")):(ae(e=>[...e,{lunghezza:150,angolo:0}]),d.success(t("configurator.sectionAdded")))},[se.length,t]),fe=o.useCallback(e=>{se.length<=1?d.error(t("configurator.minSections")):(ae(t=>t.filter((t,s)=>s!==e)),ie(null),d.success(t("configurator.sectionRemoved")))},[se.length,t]),je=o.useCallback((e,t)=>{ae(s=>s.map((s,a)=>a===e?{...s,...t}:s))},[]),be=o.useCallback(e=>{ie(t=>t===e?null:e)},[]),ye=o.useCallback(async()=>{he(!0),ue(null);try{const e={altezzaPali:ee,tipoDoghe:Y,fissaggio:V,coloreDoghe:A,colorePali:$?A:R,sezioni:se},s=await E.post("/configuratore/distinta-base",e);s?.success&&s.data?.componenti?.length>0?(xe(s.data),T(2),d.success(t("configurator.bomCalculated"))):!s?.success||s.data?.componenti&&0!==s.data.componenti.length?(ue(s?.error||s?.message||t("common.genericError")),d.error(s?.error||s?.message||t("common.genericError"))):(ue(t("configurator.bomEmpty","La distinta base Ã¨ vuota. Verificare che i prodotti siano configurati nel sistema.")),d.error(t("configurator.bomEmpty","Distinta base vuota")))}catch(e){const s=e.message||t("common.genericError");ue(s),d.error(s)}finally{he(!1)}},[ee,Y,V,A,R,$,se,t]),ve=o.useCallback(()=>{if(!de)return;r({cfgTipo:c,altezzaPali:ee,tipoDoghe:Y,fissaggio:V,coloreDoghe:A,colorePali:$?A:R,stessoColore:$,numeroDoghe:H[ee]?.[Y]||0,sezioni:se},de.componenti,de.totale),d.success(t("configurator.addedToCart")),s("/carrello")},[de,c,ee,Y,V,A,R,$,se,r,s,t]),Ne=o.useMemo(()=>se.reduce((e,t)=>e+t.lunghezza,0),[se]);return e.jsxs("div",{className:"max-w-screen-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:t("configurator.title")}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:t("configurator.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>ne("2d"),className:"px-3 py-1.5 text-sm rounded-md transition-colors "+("2d"===re?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-500 hover:text-gray-700"),children:[e.jsx(x,{size:16,className:"inline mr-1"}),"2D"]}),e.jsxs("button",{onClick:()=>ne("3d"),className:"px-3 py-1.5 text-sm rounded-md transition-colors "+("3d"===re?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-500 hover:text-gray-700"),children:[e.jsx(m,{size:16,className:"inline mr-1"}),"3D"]}),e.jsxs("button",{onClick:()=>ne("both"),className:"px-3 py-1.5 text-sm rounded-md transition-colors "+("both"===re?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-500 hover:text-gray-700"),children:[e.jsx(h,{size:16,className:"inline mr-1"}),t("configurator.bothViews")]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-6",children:J.map((s,a)=>{const r=s.icon,n=u===a,o=u>a;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>T(a),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(n?"bg-blue-600 text-white shadow-md":o?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"),children:[o?e.jsx(f,{size:16}):e.jsx(r,{size:16}),t(`configurator.steps.${s.id}`)]}),a<J.length-1&&e.jsx(j,{size:16,className:"text-gray-300"})]},s.id)})}),e.jsxs("div",{className:"grid gap-4 "+(le?"grid-cols-1":"lg:grid-cols-[380px_1fr]"),children:[!le&&e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[calc(100vh-200px)] pr-2",children:[0===u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(b,{size:16,className:"text-blue-500"}),t("configurator.color.title")]}),e.jsxs("label",{className:"flex items-center gap-2 mb-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:e=>I(e.target.checked),className:"w-4 h-4 rounded text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:t("configurator.color.sameColor")})]}),e.jsx(Q,{colori:K,value:A,onChange:G,label:t($?"configurator.color.fenceColor":"configurator.color.slatsColor")}),!$&&e.jsx("div",{className:"mt-3",children:e.jsx(Q,{colori:K,value:R,onChange:F,label:t("configurator.color.postsColor")})})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(y,{size:16,className:"text-blue-500"}),t("configurator.mounting.title")]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["cemento","terreno"].map(s=>e.jsxs("button",{onClick:()=>X(s),className:"p-3 rounded-lg border-2 text-sm font-medium transition-all "+(V===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"text-lg mb-1",children:"cemento"===s?"ðŸ§±":"ðŸŒ±"}),t(`configurator.mounting.${s}`)]},s))})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(v,{size:16,className:"text-blue-500"}),t("configurator.slats.title")]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["persiana","pieno"].map(s=>e.jsxs("button",{onClick:()=>q(s),className:"p-3 rounded-lg border-2 text-sm font-medium transition-all "+(Y===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"text-lg mb-1",children:"persiana"===s?"â‰¡":"â–ˆ"}),t(`configurator.slats.${s}`),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t("persiana"===s?"configurator.slats.persianaDesc":"configurator.slats.pienoDesc")})]},s))})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(N,{size:16,className:"text-blue-500"}),t("configurator.height.title")]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.map(s=>{const a=H[s],r="persiana"===Y?a.persiana:a.pieno;return e.jsxs("button",{onClick:()=>te(s),className:"p-3 rounded-lg border-2 text-center transition-all "+(ee===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"text-lg font-bold",children:s}),e.jsx("div",{className:"text-xs text-gray-400",children:"cm"}),e.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:[r," ",t("configurator.height.slats")]})]},s)})})]}),e.jsxs("button",{onClick:()=>T(1),className:"btn-primary w-full flex items-center justify-center gap-2",children:[t("configurator.steps.goToDesign"),e.jsx(j,{size:16})]})]}),1===u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-700",children:[e.jsx(z,{size:14,className:"inline mr-1"}),t("configurator.design.hint")]}),e.jsx("div",{className:"space-y-2",children:se.map((s,a)=>e.jsxs("div",{className:"card p-3 transition-all "+(oe===a||oe===a+1?"ring-2 ring-blue-400 bg-blue-50/30":""),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-700",children:[t("configurator.section")," ",a+1]}),se.length>1&&e.jsx("button",{onClick:()=>fe(a),className:"p-1 text-red-400 hover:text-red-600 hover:bg-red-50 rounded",title:t("configurator.design.removeSection"),children:e.jsx(k,{size:14})})]}),e.jsx(Z,{value:s.lunghezza,min:10,max:150,onChange:e=>je(a,{lunghezza:e}),label:t("configurator.design.length")}),a>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(w,{size:12,className:"text-gray-400"}),e.jsx("input",{type:"checkbox",checked:90===s.angolo,onChange:e=>je(a,{angolo:e.target.checked?90:0}),className:"w-4 h-4 rounded text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:t("configurator.design.angle90")})]})})]},a))}),e.jsxs("button",{onClick:pe,disabled:se.length>=20,className:"w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-sm text-gray-500 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50/50 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(S,{size:16}),t("configurator.design.addSection"),se.length>=20&&` (${t("configurator.maxReached")})`]}),e.jsx("div",{className:"card p-3 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:se.length}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.sections")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:se.length+1}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.posts")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:Ne}),e.jsxs("div",{className:"text-xs text-gray-500",children:["cm ",t("configurator.summary.total")]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>T(0),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(C,{size:16}),t("configurator.steps.back")]}),e.jsxs("button",{onClick:ye,disabled:me,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[me?e.jsx("span",{className:"animate-spin",children:"â³"}):e.jsx(p,{size:16}),t("configurator.steps.calculateBom")]})]})]}),2===u&&de&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:t("configurator.bom.summary")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.numSezioni}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.sections")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.numPali}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.posts")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.numDoghePerSezione}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.bom.slatsPerSection")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.lunghezzaTotale}),e.jsxs("div",{className:"text-xs text-gray-500",children:["cm ",t("configurator.summary.total")]})]})]})]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left",children:[e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600",children:t("configurator.bom.code")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600",children:t("configurator.bom.description")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600 text-center",children:t("configurator.bom.qty")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600 text-right",children:t("configurator.bom.unitPrice")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600 text-right",children:t("configurator.bom.totalPrice")})]})}),e.jsx("tbody",{children:de.componenti.map((t,s)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 font-mono text-xs text-gray-500",children:t.prdCod}),e.jsx("td",{className:"px-3 py-2",children:t.prdDes}),e.jsx("td",{className:"px-3 py-2 text-center font-medium",children:t.quantita}),e.jsx("td",{className:"px-3 py-2 text-right",children:n.currency(t.prezzoUnitario)}),e.jsx("td",{className:"px-3 py-2 text-right font-medium",children:n.currency(t.prezzoTotale)})]},s))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 bg-blue-50",children:[e.jsx("td",{colSpan:4,className:"px-3 py-3 text-right font-bold text-gray-700",children:t("configurator.bom.grandTotal")}),e.jsx("td",{className:"px-3 py-3 text-right font-bold text-blue-700 text-lg",children:n.currency(de.totale)})]})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>T(1),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(C,{size:16}),t("configurator.steps.back")]}),e.jsxs("button",{onClick:ve,className:"btn-success flex-1 flex items-center justify-center gap-2",children:[e.jsx(M,{size:16}),t("configurator.addToCart")]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>ce(!le),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",title:t(le?"configurator.exitFullscreen":"configurator.fullscreen"),children:le?e.jsx(P,{size:16}):e.jsx(D,{size:16})})}),("3d"===re||"both"===re)&&e.jsx("div",{className:`card overflow-hidden ${"both"===re?"h-[350px] lg:h-[400px]":"h-[500px] lg:h-[600px]"} ${le?"h-[70vh]":""}`,children:e.jsx(U,{sezioni:se,altezzaPali:ee,tipoDoghe:Y,coloreDoghe:A,colorePali:$?A:R,selectedPaloIndex:oe,onPaloClick:be})}),("2d"===re||"both"===re)&&e.jsx("div",{className:"card p-2",children:e.jsx(O,{sezioni:se,colorePali:$?A:R,coloreDoghe:A,selectedPaloIndex:oe,onPaloClick:be,onAddSezione:pe,onRemoveSezione:fe,onUpdateSezione:je})})]})]})]})}export{ee as default};
========
import{j as e,C as t,O as s,a,G as r,T as n}from"./vendor-three-CHCIWYOy.js";import{r as o,c as i,u as l}from"./vendor-react-DmByJA4P.js";import{p as c,z as d,q as x,B as m,E as h,r as g,s as u,F as p,t as f,o as j,g as b,A as y,f as v,u as N,v as z,w as k,x as w,i as S,C,S as M,y as P,H as D}from"./vendor-ui-CwcPvQqL.js";import{c as B,a as E}from"./index-B4jmuTia.js";import{u as L}from"./formatters-BFOEvdlG.js";import{u as W}from"./vendor-i18n-BveTNVnu.js";const T=.06,$=.06,I=.04,A=.01,G={100:{persiana:8,pieno:9},150:{persiana:12,pieno:14},185:{persiana:15,pieno:17},200:{persiana:16,pieno:18}};function R({position:t,altezza:s,colore:a,isSelected:r,onClick:n}){const i=o.useRef(),l=s*A;return e.jsxs("group",{position:t,children:[e.jsxs("mesh",{ref:i,position:[0,l/2,0],onClick:n,castShadow:!0,children:[e.jsx("boxGeometry",{args:[T,l,$]}),e.jsx("meshStandardMaterial",{color:a,roughness:.7,metalness:.1})]}),[-1,1].map(t=>e.jsxs("mesh",{position:[t*T*.35,l/2,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.005,l-.02,.062]}),e.jsx("meshStandardMaterial",{color:a,roughness:.5,metalness:.15})]},t)),e.jsxs("mesh",{position:[0,l+.015,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.075,.03,.075]}),e.jsx("meshStandardMaterial",{color:a,roughness:.4,metalness:.2})]}),r&&e.jsxs("mesh",{position:[0,l+.08,0],children:[e.jsx("sphereGeometry",{args:[.02,16,16]}),e.jsx("meshStandardMaterial",{color:"#3b82f6",emissive:"#3b82f6",emissiveIntensity:.5})]}),e.jsxs("mesh",{position:[0,.005,0],castShadow:!0,children:[e.jsx("boxGeometry",{args:[.09,.01,.09]}),e.jsx("meshStandardMaterial",{color:"#555555",roughness:.9,metalness:.3})]})]})}function F({position:t,lunghezza:s,colore:a,isPersiana:r,rotation:n=[0,0,0]}){const o=s*A,i=r?.25:0;return e.jsxs("mesh",{position:t,rotation:[i,n[1],n[2]],castShadow:!0,receiveShadow:!0,children:[e.jsx("boxGeometry",{args:[o-T,I,.02]}),e.jsx("meshStandardMaterial",{color:a,roughness:.65,metalness:.05})]})}function V({startPos:t,endPos:s,altezza:a,tipoDoghe:r,coloreDoghe:n,numDoghe:i}){const l="persiana"===r,c=l?.03:.002,d=a*A,x=(t[0]+s[0])/2,m=(t[2]+s[2])/2,h=s[0]-t[0],g=s[2]-t[2],u=Math.sqrt(h*h+g*g)/A,p=Math.atan2(g,h),f=o.useMemo(()=>{const e=[],t=(d-(i*I+(i-1)*c))/2+.02+.02;for(let s=0;s<i;s++)e.push(t+s*(I+c));return e},[i,d,c]);return e.jsx("group",{children:f.map((t,s)=>e.jsx(F,{position:[x,t,m],lunghezza:u,colore:n,isPersiana:l,rotation:[0,p,0]},s))})}function X(){return e.jsxs("group",{children:[e.jsx(r,{args:[20,20],cellSize:.5,cellThickness:.5,cellColor:"#a0a0a0",sectionSize:2.5,sectionThickness:1,sectionColor:"#707070",fadeDistance:15,fadeStrength:1.5,position:[0,0,0]}),e.jsxs("mesh",{rotation:[-Math.PI/2,0,0],position:[0,-.001,0],receiveShadow:!0,children:[e.jsx("planeGeometry",{args:[20,20]}),e.jsx("meshStandardMaterial",{color:"#e8e8e0",transparent:!0,opacity:.3})]})]})}function Y({start:t,end:s,label:a,yOffset:r=-.05}){const o=(t[0]+s[0])/2,i=(t[2]+s[2])/2;return e.jsx("group",{children:e.jsx(n,{position:[o,r,i-.1],fontSize:.06,color:"#333333",anchorX:"center",anchorY:"middle",children:a})})}function q({sezioni:t,altezzaPali:r,tipoDoghe:n,coloreDoghe:i,colorePali:l,selectedPaloIndex:c,onPaloClick:d}){const x=o.useMemo(()=>{const e=[[0,0,0]];let s=0;for(const a of t){const t=e[e.length-1];s+=(a.angolo||0)*(Math.PI/180);const r=a.lunghezza*A,n=t[0]+Math.cos(s)*r,o=t[2]+Math.sin(s)*r;e.push([n,0,o])}return e},[t]),m=G[r]?"persiana"===n?G[r].persiana:G[r].pieno:12,h=o.useMemo(()=>{if(0===x.length)return[0,0,0];const e=x.map(e=>e[0]),t=x.map(e=>e[2]);return[(Math.min(...e)+Math.max(...e))/2,r*A/2,(Math.min(...t)+Math.max(...t))/2]},[x,r]);return e.jsxs(e.Fragment,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("directionalLight",{position:[5,8,5],intensity:1.2,castShadow:!0,"shadow-mapSize-width":2048,"shadow-mapSize-height":2048}),e.jsx("directionalLight",{position:[-3,5,-3],intensity:.3}),e.jsx(s,{target:h,minDistance:.5,maxDistance:15,maxPolarAngle:Math.PI/2-.05,enableDamping:!0,dampingFactor:.08}),e.jsx(X,{}),e.jsx(a,{position:[0,0,0],opacity:.4,scale:15,blur:2,far:5}),x.map((t,s)=>e.jsx(R,{position:t,altezza:r,colore:l,isSelected:c===s,onClick:e=>{e.stopPropagation(),d?.(s)}},`palo-${s}`)),t.map((t,s)=>e.jsx(V,{startPos:x[s],endPos:x[s+1],altezza:r,tipoDoghe:n,coloreDoghe:i,numDoghe:m},`sez-${s}`)),t.map((t,s)=>e.jsx(Y,{start:x[s],end:x[s+1],label:`${t.lunghezza} cm`},`dim-${s}`))]})}function U({sezioni:s=[],altezzaPali:a=150,tipoDoghe:r="persiana",coloreDoghe:n="#7B7B7B",colorePali:o="#7B7B7B",selectedPaloIndex:i=null,onPaloClick:l,className:c=""}){return e.jsx("div",{className:`w-full h-full min-h-[300px] ${c}`,children:e.jsx(t,{shadows:!0,camera:{position:[3,2.5,3],fov:45,near:.1,far:100},gl:{antialias:!0,alpha:!0},style:{background:"linear-gradient(180deg, #e0eaf5 0%, #f5f5f0 60%)"},children:e.jsx(q,{sezioni:s,altezzaPali:a,tipoDoghe:r,coloreDoghe:n,colorePali:o,selectedPaloIndex:i,onPaloClick:l})})})}function O({sezioni:t=[],colorePali:s="#7B7B7B",coloreDoghe:a="#7B7B7B",selectedPaloIndex:r=null,onPaloClick:n,onAddSezione:i,onRemoveSezione:l,onUpdateSezione:d,className:x=""}){const{t:m}=W(),h=o.useRef(null),[g,u]=o.useState(null),[p,f]=o.useState(!1),[j,b]=o.useState(null),[y,v]=o.useState({width:600,height:350});o.useEffect(()=>{const e=new ResizeObserver(e=>{for(const t of e){const{width:e}=t.contentRect;v({width:Math.max(400,e),height:Math.max(250,Math.min(400,.55*e))})}});return h.current?.parentElement&&e.observe(h.current.parentElement),()=>e.disconnect()},[]);const{paliSVG:N,bounds:z,scale:k}=o.useMemo(()=>{const e=[{x:0,y:0}];let s=0;for(const p of t){const t=e[e.length-1];s+=(p.angolo||0)*(Math.PI/180),e.push({x:t.x+Math.cos(s)*p.lunghezza,y:t.y+Math.sin(s)*p.lunghezza})}const a=e.map(e=>e.x),r=e.map(e=>e.y),n=Math.min(...a),o=Math.max(...a),i=Math.min(...r),l=Math.max(...r),c=o-n||150,d=l-i||50,x=y.width-120,m=y.height-120,h=Math.min(x/c,m/Math.max(d,30),3),g=60+(x-c*h)/2,u=60+(m-d*h)/2;return{paliSVG:e.map(e=>({x:g+(e.x-n)*h,y:u+(e.y-i)*h})),bounds:{minX:n,maxX:o,minY:i,maxY:l,realW:c,realH:d},scale:h}},[t,y]),w=o.useCallback((e,s)=>{s.stopPropagation(),e===N.length-1&&t.length<20?i?.():n?.(e)},[N.length,t.length,i,n]),S=o.useCallback((e,t)=>{0===e||e>=N.length||(t.preventDefault(),f(!0),b(e))},[N.length]),C=o.useCallback(e=>{if(!p||null===j||!h.current)return;const t=h.current.getBoundingClientRect(),s=e.touches?e.touches[0].clientX:e.clientX,a=e.touches?e.touches[0].clientY:e.clientY,r=s-t.left,n=a-t.top,o=N[j-1],i=r-o.x,l=n-o.y,c=Math.sqrt(i*i+l*l),x=Math.round(Math.max(10,Math.min(150,c/k))),m=Math.atan2(l,i);let g=0;if(j>1){const e=N[j-2],t=N[j-1];g=Math.atan2(t.y-e.y,t.x-e.x)}const u=Math.round(180*(m-g)/Math.PI),f=Math.abs(u)>=45?90:0;d?.(j-1,{lunghezza:x,angolo:f})},[p,j,N,k,d]),M=o.useCallback(()=>{f(!1),b(null)},[]);o.useEffect(()=>{if(p)return window.addEventListener("mousemove",C),window.addEventListener("mouseup",M),window.addEventListener("touchmove",C),window.addEventListener("touchend",M),()=>{window.removeEventListener("mousemove",C),window.removeEventListener("mouseup",M),window.removeEventListener("touchmove",C),window.removeEventListener("touchend",M)}},[p,C,M]);return e.jsxs("div",{className:`relative ${x}`,children:[e.jsxs("div",{className:"absolute top-2 left-2 flex items-center gap-3 text-xs text-gray-500 z-10",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"w-3 h-3 rounded-full border-2 border-blue-500 bg-blue-100 inline-block"}),m("configurator.plan.clickToAdd")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(c,{size:12}),m("configurator.plan.dragToResize")]})]}),e.jsxs("svg",{ref:h,width:y.width,height:y.height,className:"w-full border border-gray-200 rounded-lg bg-white",style:{cursor:p?"grabbing":"default"},children:[e.jsxs("defs",{children:[e.jsx("pattern",{id:"grid",width:"30",height:"30",patternUnits:"userSpaceOnUse",children:e.jsx("path",{d:"M 30 0 L 0 0 0 30",fill:"none",stroke:"#f0f0f0",strokeWidth:"0.5"})}),e.jsx("marker",{id:"arrowhead",markerWidth:"8",markerHeight:"6",refX:"4",refY:"3",orient:"auto",children:e.jsx("polygon",{points:"0 0, 8 3, 0 6",fill:"#999"})})]}),e.jsx("rect",{width:"100%",height:"100%",fill:"url(#grid)",rx:"8"}),e.jsxs("text",{x:y.width/2,y:20,textAnchor:"middle",fontSize:"11",fill:"#888",fontWeight:"500",children:[m("configurator.plan.title")," â€” ",m("configurator.plan.topView")]}),t.map((t,s)=>{const r=N[s],n=N[s+1];return r&&n?e.jsxs("g",{children:[e.jsx("line",{x1:r.x,y1:r.y+2,x2:n.x,y2:n.y+2,stroke:"rgba(0,0,0,0.08)",strokeWidth:12,strokeLinecap:"round"}),e.jsx("line",{x1:r.x,y1:r.y,x2:n.x,y2:n.y,stroke:a,strokeWidth:10,strokeLinecap:"round",opacity:.85}),e.jsx("line",{x1:r.x,y1:r.y,x2:n.x,y2:n.y,stroke:a,strokeWidth:12,strokeLinecap:"round",opacity:.3}),e.jsxs("text",{x:(r.x+n.x)/2,y:(r.y+n.y)/2-20,textAnchor:"middle",fontSize:"12",fontWeight:"600",fill:"#333",className:"select-none pointer-events-none",children:[t.lunghezza," cm"]}),e.jsxs("text",{x:(r.x+n.x)/2,y:(r.y+n.y)/2+20+5,textAnchor:"middle",fontSize:"9",fill:"#888",className:"select-none pointer-events-none",children:[m("configurator.section")," ",s+1]})]},`sez-line-${s}`):null}),t.map((t,s)=>{if(0===s||0===t.angolo)return null;const a=N[s];return a?e.jsxs("g",{children:[e.jsx("circle",{cx:a.x,cy:a.y,r:25,fill:"none",stroke:"#3b82f6",strokeWidth:"1",strokeDasharray:"3,3",opacity:.4}),e.jsxs("text",{x:a.x+25+4,y:a.y-4,fontSize:"10",fill:"#3b82f6",fontWeight:"500",children:[t.angolo,"Â°"]})]},`angle-${s}`):null}),N.map((a,n)=>{const o=r===n,i=g===n,l=(e=>e===N.length-1)(n),c=l&&t.length<20;let d=8;return o&&(d=11),i&&(d=14),e.jsxs("g",{onClick:e=>w(n,e),onMouseDown:e=>S(n,e),onTouchStart:e=>S(n,e),onMouseEnter:()=>u(n),onMouseLeave:()=>u(null),style:{cursor:c?"pointer":n>0?"grab":"default"},children:[i&&e.jsx("circle",{cx:a.x,cy:a.y,r:d+6,fill:c?"rgba(59,130,246,0.1)":"rgba(0,0,0,0.05)",stroke:c?"#3b82f6":"#ccc",strokeWidth:"1",strokeDasharray:c?"none":"3,3"}),e.jsx("circle",{cx:a.x,cy:a.y,r:d,fill:o?"#3b82f6":s,stroke:o?"#1d4ed8":"#555",strokeWidth:o?3:1.5}),c&&e.jsxs(e.Fragment,{children:[e.jsx("line",{x1:a.x-4,y1:a.y,x2:a.x+4,y2:a.y,stroke:"white",strokeWidth:"2",strokeLinecap:"round",className:"pointer-events-none"}),e.jsx("line",{x1:a.x,y1:a.y-4,x2:a.x,y2:a.y+4,stroke:"white",strokeWidth:"2",strokeLinecap:"round",className:"pointer-events-none"})]}),e.jsxs("text",{x:a.x,y:a.y+d+14,textAnchor:"middle",fontSize:"9",fill:o?"#1d4ed8":"#666",fontWeight:o?"600":"400",className:"select-none pointer-events-none",children:["P",n+1]})]},`palo-${n}`)}),0===t.length&&1===N.length&&e.jsxs("text",{x:N[0].x+30,y:N[0].y,fontSize:"12",fill:"#999",dominantBaseline:"middle",children:["â† ",m("configurator.plan.clickFirstPost")]}),k>0&&e.jsxs("g",{children:[e.jsx("line",{x1:15,y1:y.height-20,x2:15+100*k*.5,y2:y.height-20,stroke:"#999",strokeWidth:"1"}),e.jsxs("text",{x:15+100*k*.5/2,y:y.height-8,textAnchor:"middle",fontSize:"9",fill:"#999",children:[Math.round(50)," cm"]})]})]})]})}const H={100:{persiana:8,pieno:9},150:{persiana:12,pieno:14},185:{persiana:15,pieno:17},200:{persiana:16,pieno:18}},K=[{hex:"#7B7B7B",nome:"Grigio"},{hex:"#2D5A27",nome:"Verde"},{hex:"#8B4513",nome:"Rosso mattone"}],_=[100,150,185,200],J=[{id:"parametri",icon:g},{id:"disegno",icon:u},{id:"riepilogo",icon:p}];function Q({colori:t,value:s,onChange:a,label:r}){return e.jsxs("div",{className:"flex flex-col gap-1.5",children:[r&&e.jsx("span",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:r}),e.jsx("div",{className:"flex gap-2",children:t.map(t=>e.jsx("button",{className:"w-10 h-10 rounded-full border-2 transition-all duration-200 hover:scale-110 "+(s===t.hex?"border-blue-500 ring-2 ring-blue-200 scale-110":"border-gray-300 hover:border-gray-400"),style:{backgroundColor:t.hex},onClick:()=>a(t.hex),title:t.nome},t.hex))})]})}function Z({value:t,min:s,max:a,step:r=1,onChange:n,unit:i="cm",label:l}){const[c,d]=o.useState(t);o.useEffect(()=>d(t),[t]);const x=()=>{const e=Math.max(s,Math.min(a,Number(c)||s));d(e),n(e)};return e.jsxs("div",{className:"flex items-center gap-3",children:[l&&e.jsx("span",{className:"text-sm text-gray-600 w-16 shrink-0",children:l}),e.jsx("input",{type:"range",min:s,max:a,step:r,value:c,onChange:e=>{d(Number(e.target.value)),n(Number(e.target.value))},className:"flex-1 h-2 rounded-lg appearance-none cursor-pointer bg-gray-200 accent-blue-600"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",min:s,max:a,step:r,value:c,onChange:e=>d(e.target.value),onBlur:x,onKeyDown:e=>"Enter"===e.key&&x(),className:"w-16 px-2 py-1 text-sm text-center border border-gray-300 rounded focus:ring-1 focus:ring-blue-500 focus:border-blue-500"}),e.jsx("span",{className:"text-xs text-gray-400",children:i})]})]})}function ee(){const{t:t}=W(),s=i(),a=l(),r=B(e=>e.addConfiguredItem),n=L(),[c,g]=o.useState("recinzione"),[u,T]=o.useState(0),[$,I]=o.useState(!0),[A,G]=o.useState("#7B7B7B"),[R,F]=o.useState("#7B7B7B"),[V,X]=o.useState("cemento"),[Y,q]=o.useState("persiana"),[ee,te]=o.useState(150),[se,ae]=o.useState([{lunghezza:150,angolo:0}]),[re,ne]=o.useState("both"),[oe,ie]=o.useState(null),[le,ce]=o.useState(!1),[de,xe]=o.useState(null),[me,he]=o.useState(!1),[ge,ue]=o.useState(null);o.useEffect(()=>{if(a.state?.fromProduct){const e=a.state.fromProduct;e.cfgTipo&&g(e.cfgTipo),d.success(t("configurator.fromCatalog"))}},[a.state]),o.useEffect(()=>{$&&F(A)},[$,A]),o.useMemo(()=>{const e=H[ee];return e?"persiana"===Y?e.persiana:e.pieno:12},[ee,Y]);const pe=o.useCallback(()=>{se.length>=20?d.error(t("configurator.maxSections")):(ae(e=>[...e,{lunghezza:150,angolo:0}]),d.success(t("configurator.sectionAdded")))},[se.length,t]),fe=o.useCallback(e=>{se.length<=1?d.error(t("configurator.minSections")):(ae(t=>t.filter((t,s)=>s!==e)),ie(null),d.success(t("configurator.sectionRemoved")))},[se.length,t]),je=o.useCallback((e,t)=>{ae(s=>s.map((s,a)=>a===e?{...s,...t}:s))},[]),be=o.useCallback(e=>{ie(t=>t===e?null:e)},[]),ye=o.useCallback(async()=>{he(!0),ue(null);try{const e={altezzaPali:ee,tipoDoghe:Y,fissaggio:V,coloreDoghe:A,colorePali:$?A:R,sezioni:se},s=await E.post("/configuratore/distinta-base",e);s?.success&&s.data?.componenti?.length>0?(xe(s.data),T(2),d.success(t("configurator.bomCalculated"))):!s?.success||s.data?.componenti&&0!==s.data.componenti.length?(ue(s?.error||s?.message||t("common.genericError")),d.error(s?.error||s?.message||t("common.genericError"))):(ue(t("configurator.bomEmpty","La distinta base Ã¨ vuota. Verificare che i prodotti siano configurati nel sistema.")),d.error(t("configurator.bomEmpty","Distinta base vuota")))}catch(e){const s=e.message||t("common.genericError");ue(s),d.error(s)}finally{he(!1)}},[ee,Y,V,A,R,$,se,t]),ve=o.useCallback(()=>{if(!de)return;r({cfgTipo:c,altezzaPali:ee,tipoDoghe:Y,fissaggio:V,coloreDoghe:A,colorePali:$?A:R,stessoColore:$,numeroDoghe:H[ee]?.[Y]||0,sezioni:se},de.componenti,de.totale),d.success(t("configurator.addedToCart")),s("/carrello")},[de,c,ee,Y,V,A,R,$,se,r,s,t]),Ne=o.useMemo(()=>se.reduce((e,t)=>e+t.lunghezza,0),[se]);return e.jsxs("div",{className:"max-w-screen-2xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:t("configurator.title")}),e.jsx("p",{className:"text-sm text-gray-500 mt-0.5",children:t("configurator.subtitle")})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-gray-100 rounded-lg p-1",children:[e.jsxs("button",{onClick:()=>ne("2d"),className:"px-3 py-1.5 text-sm rounded-md transition-colors "+("2d"===re?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-500 hover:text-gray-700"),children:[e.jsx(x,{size:16,className:"inline mr-1"}),"2D"]}),e.jsxs("button",{onClick:()=>ne("3d"),className:"px-3 py-1.5 text-sm rounded-md transition-colors "+("3d"===re?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-500 hover:text-gray-700"),children:[e.jsx(m,{size:16,className:"inline mr-1"}),"3D"]}),e.jsxs("button",{onClick:()=>ne("both"),className:"px-3 py-1.5 text-sm rounded-md transition-colors "+("both"===re?"bg-white text-blue-600 shadow-sm font-medium":"text-gray-500 hover:text-gray-700"),children:[e.jsx(h,{size:16,className:"inline mr-1"}),t("configurator.bothViews")]})]})]}),e.jsx("div",{className:"flex items-center gap-2 mb-6",children:J.map((s,a)=>{const r=s.icon,n=u===a,o=u>a;return e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{onClick:()=>T(a),className:"flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all "+(n?"bg-blue-600 text-white shadow-md":o?"bg-green-100 text-green-700 hover:bg-green-200":"bg-gray-100 text-gray-500 hover:bg-gray-200"),children:[o?e.jsx(f,{size:16}):e.jsx(r,{size:16}),t(`configurator.steps.${s.id}`)]}),a<J.length-1&&e.jsx(j,{size:16,className:"text-gray-300"})]},s.id)})}),e.jsxs("div",{className:"grid gap-4 "+(le?"grid-cols-1":"lg:grid-cols-[380px_1fr]"),children:[!le&&e.jsxs("div",{className:"space-y-4 overflow-y-auto max-h-[calc(100vh-200px)] pr-2",children:[0===u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(b,{size:16,className:"text-blue-500"}),t("configurator.color.title")]}),e.jsxs("label",{className:"flex items-center gap-2 mb-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:e=>I(e.target.checked),className:"w-4 h-4 rounded text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:t("configurator.color.sameColor")})]}),e.jsx(Q,{colori:K,value:A,onChange:G,label:t($?"configurator.color.fenceColor":"configurator.color.slatsColor")}),!$&&e.jsx("div",{className:"mt-3",children:e.jsx(Q,{colori:K,value:R,onChange:F,label:t("configurator.color.postsColor")})})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(y,{size:16,className:"text-blue-500"}),t("configurator.mounting.title")]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["cemento","terreno"].map(s=>e.jsxs("button",{onClick:()=>X(s),className:"p-3 rounded-lg border-2 text-sm font-medium transition-all "+(V===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"text-lg mb-1",children:"cemento"===s?"ðŸ§±":"ðŸŒ±"}),t(`configurator.mounting.${s}`)]},s))})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(v,{size:16,className:"text-blue-500"}),t("configurator.slats.title")]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["persiana","pieno"].map(s=>e.jsxs("button",{onClick:()=>q(s),className:"p-3 rounded-lg border-2 text-sm font-medium transition-all "+(Y===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"text-lg mb-1",children:"persiana"===s?"â‰¡":"â–ˆ"}),t(`configurator.slats.${s}`),e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:t("persiana"===s?"configurator.slats.persianaDesc":"configurator.slats.pienoDesc")})]},s))})]}),e.jsxs("div",{className:"card p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-gray-700 mb-3 flex items-center gap-2",children:[e.jsx(N,{size:16,className:"text-blue-500"}),t("configurator.height.title")]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:_.map(s=>{const a=H[s],r="persiana"===Y?a.persiana:a.pieno;return e.jsxs("button",{onClick:()=>te(s),className:"p-3 rounded-lg border-2 text-center transition-all "+(ee===s?"border-blue-500 bg-blue-50 text-blue-700":"border-gray-200 bg-white text-gray-600 hover:border-gray-300"),children:[e.jsx("div",{className:"text-lg font-bold",children:s}),e.jsx("div",{className:"text-xs text-gray-400",children:"cm"}),e.jsxs("div",{className:"text-xs mt-1 text-gray-500",children:[r," ",t("configurator.height.slats")]})]},s)})})]}),e.jsxs("button",{onClick:()=>T(1),className:"btn-primary w-full flex items-center justify-center gap-2",children:[t("configurator.steps.goToDesign"),e.jsx(j,{size:16})]})]}),1===u&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 text-sm text-blue-700",children:[e.jsx(z,{size:14,className:"inline mr-1"}),t("configurator.design.hint")]}),e.jsx("div",{className:"space-y-2",children:se.map((s,a)=>e.jsxs("div",{className:"card p-3 transition-all "+(oe===a||oe===a+1?"ring-2 ring-blue-400 bg-blue-50/30":""),children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm font-semibold text-gray-700",children:[t("configurator.section")," ",a+1]}),se.length>1&&e.jsx("button",{onClick:()=>fe(a),className:"p-1 text-red-400 hover:text-red-600 hover:bg-red-50 rounded",title:t("configurator.design.removeSection"),children:e.jsx(k,{size:14})})]}),e.jsx(Z,{value:s.lunghezza,min:10,max:150,onChange:e=>je(a,{lunghezza:e}),label:t("configurator.design.length")}),a>0&&e.jsx("div",{className:"mt-2",children:e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx(w,{size:12,className:"text-gray-400"}),e.jsx("input",{type:"checkbox",checked:90===s.angolo,onChange:e=>je(a,{angolo:e.target.checked?90:0}),className:"w-4 h-4 rounded text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm text-gray-600",children:t("configurator.design.angle90")})]})})]},a))}),e.jsxs("button",{onClick:pe,disabled:se.length>=20,className:"w-full p-3 border-2 border-dashed border-gray-300 rounded-lg text-sm text-gray-500 hover:border-blue-400 hover:text-blue-600 hover:bg-blue-50/50 transition-all disabled:opacity-40 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(S,{size:16}),t("configurator.design.addSection"),se.length>=20&&` (${t("configurator.maxReached")})`]}),e.jsx("div",{className:"card p-3 bg-gray-50",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 text-center text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:se.length}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.sections")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:se.length+1}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.posts")})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-lg font-bold text-gray-800",children:Ne}),e.jsxs("div",{className:"text-xs text-gray-500",children:["cm ",t("configurator.summary.total")]})]})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>T(0),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(C,{size:16}),t("configurator.steps.back")]}),e.jsxs("button",{onClick:ye,disabled:me,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[me?e.jsx("span",{className:"animate-spin",children:"â³"}):e.jsx(p,{size:16}),t("configurator.steps.calculateBom")]})]})]}),2===u&&de&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-700 mb-3",children:t("configurator.bom.summary")}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.numSezioni}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.sections")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.numPali}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.summary.posts")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.numDoghePerSezione}),e.jsx("div",{className:"text-xs text-gray-500",children:t("configurator.bom.slatsPerSection")})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 text-center",children:[e.jsx("div",{className:"text-xl font-bold text-gray-800",children:de.riepilogo.lunghezzaTotale}),e.jsxs("div",{className:"text-xs text-gray-500",children:["cm ",t("configurator.summary.total")]})]})]})]}),e.jsx("div",{className:"card overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left",children:[e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600",children:t("configurator.bom.code")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600",children:t("configurator.bom.description")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600 text-center",children:t("configurator.bom.qty")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600 text-right",children:t("configurator.bom.unitPrice")}),e.jsx("th",{className:"px-3 py-2 font-medium text-gray-600 text-right",children:t("configurator.bom.totalPrice")})]})}),e.jsx("tbody",{children:de.componenti.map((t,s)=>e.jsxs("tr",{className:"border-t border-gray-100 hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 font-mono text-xs text-gray-500",children:t.prdCod}),e.jsx("td",{className:"px-3 py-2",children:t.prdDes}),e.jsx("td",{className:"px-3 py-2 text-center font-medium",children:t.quantita}),e.jsx("td",{className:"px-3 py-2 text-right",children:n.currency(t.prezzoUnitario)}),e.jsx("td",{className:"px-3 py-2 text-right font-medium",children:n.currency(t.prezzoTotale)})]},s))}),e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 bg-blue-50",children:[e.jsx("td",{colSpan:4,className:"px-3 py-3 text-right font-bold text-gray-700",children:t("configurator.bom.grandTotal")}),e.jsx("td",{className:"px-3 py-3 text-right font-bold text-blue-700 text-lg",children:n.currency(de.totale)})]})})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>T(1),className:"btn-secondary flex-1 flex items-center justify-center gap-2",children:[e.jsx(C,{size:16}),t("configurator.steps.back")]}),e.jsxs("button",{onClick:ve,className:"btn-success flex-1 flex items-center justify-center gap-2",children:[e.jsx(M,{size:16}),t("configurator.addToCart")]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:()=>ce(!le),className:"p-1.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded",title:t(le?"configurator.exitFullscreen":"configurator.fullscreen"),children:le?e.jsx(P,{size:16}):e.jsx(D,{size:16})})}),("3d"===re||"both"===re)&&e.jsx("div",{className:`card overflow-hidden ${"both"===re?"h-[350px] lg:h-[400px]":"h-[500px] lg:h-[600px]"} ${le?"h-[70vh]":""}`,children:e.jsx(U,{sezioni:se,altezzaPali:ee,tipoDoghe:Y,coloreDoghe:A,colorePali:$?A:R,selectedPaloIndex:oe,onPaloClick:be})}),("2d"===re||"both"===re)&&e.jsx("div",{className:"card p-2",children:e.jsx(O,{sezioni:se,colorePali:$?A:R,coloreDoghe:A,selectedPaloIndex:oe,onPaloClick:be,onAddSezione:pe,onRemoveSezione:fe,onUpdateSezione:je})})]})]})]})}export{ee as default};
>>>>>>>> b14fddd03b77d08e3848a85997451506e8f4e865:recinzioni-portal/backend/RecinzioniPortal.API/publish/wwwroot/assets/ConfiguratorPage-BU7mjx5I.js
