import{j as e}from"./vendor-three-CHCIWYOy.js";import{r as s}from"./vendor-react-DmByJA4P.js";import{b as t,a as r}from"./index-DUQFKziG.js";import{u as a}from"./formatters-BFOEvdlG.js";import{F as l,X as n,Z as c,v as o,V as i,D as d,R as x,_ as m,z as p,m as u,P as h,E as g,w as b,N as j,O as f,h as y,b as N,$ as w,a0 as v}from"./vendor-ui-CwcPvQqL.js";import{u as C}from"./vendor-i18n-BveTNVnu.js";const S={BGM:{bg:"bg-blue-50",text:"text-blue-800",border:"border-blue-200",label:"Testata"},NAS:{bg:"bg-green-50",text:"text-green-800",border:"border-green-200",label:"Fornitore"},CTA:{bg:"bg-green-50",text:"text-green-700",border:"border-green-200",label:"Contatto"},NAB:{bg:"bg-emerald-50",text:"text-emerald-800",border:"border-emerald-200",label:"Buyer"},NAD:{bg:"bg-teal-50",text:"text-teal-800",border:"border-teal-200",label:"Consegna"},NAI:{bg:"bg-cyan-50",text:"text-cyan-800",border:"border-cyan-200",label:"Fattura"},DTM:{bg:"bg-orange-50",text:"text-orange-800",border:"border-orange-200",label:"Data consegna"},FTX:{bg:"bg-yellow-50",text:"text-yellow-800",border:"border-yellow-200",label:"Note"},PAT:{bg:"bg-amber-50",text:"text-amber-800",border:"border-amber-200",label:"Pagamento"},LIN:{bg:"bg-gray-50",text:"text-gray-700",border:"border-gray-200",label:"Riga prodotto"},CNT:{bg:"bg-purple-50",text:"text-purple-800",border:"border-purple-200",label:"Sommario"}};function k({ordNum:u,isOpen:h,onClose:g,onSent:b}){const{t:j}=C(),f=a(),y=s.useRef(null);t(y,h,g);const[N,w]=s.useState(!1),[v,k]=s.useState(!1),[R,$]=s.useState(null),[z,D]=s.useState(null);s.useEffect(()=>(h&&u&&P(),()=>{$(null),D(null)}),[h,u]);const P=async()=>{w(!0),D(null);try{const e=await r.get(`/ordini/${u}/euritmo/preview`);e?.success?$(e.data):D(e?.message||j("euritmo.loadError"))}catch(e){D(j("euritmo.loadError"))}finally{w(!1)}};return h?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4",children:e.jsxs("div",{ref:y,className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",role:"dialog","aria-modal":"true","aria-labelledby":"euritmo-modal-title",children:[e.jsxs("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(l,{className:"w-5 h-5 text-blue-600"}),e.jsxs("div",{children:[e.jsxs("h2",{id:"euritmo-modal-title",className:"text-lg font-semibold text-gray-800",children:[j("euritmo.preview")," â€” ",j("orders.number")," ",u]}),e.jsx("p",{className:"text-sm text-gray-500",children:"EURITMO ORDERS Release 25.1"})]})]}),e.jsx("button",{onClick:g,className:"p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(n,{className:"w-5 h-5 text-gray-500"})})]}),R&&e.jsx("div",{className:"mx-6 mt-4 px-4 py-2 rounded-lg flex items-center gap-2 text-sm "+(R.sent?"bg-green-50 text-green-700 border border-green-200":"bg-yellow-50 text-yellow-700 border border-yellow-200"),children:R.sent?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"w-4 h-4"}),j("euritmo.sentAt",{date:f.date(R.sentAt),time:new Date(R.sentAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}):e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"w-4 h-4"}),j("euritmo.notSent")]})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:N?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-gray-500",children:[e.jsx(i,{className:"w-8 h-8 animate-spin mb-3"}),e.jsx("p",{children:j("euritmo.generating")})]}):z?e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 text-red-500",children:[e.jsx(o,{className:"w-8 h-8 mb-3"}),e.jsx("p",{children:z})]}):e.jsx("div",{className:"space-y-0.5 rounded-lg overflow-hidden border border-gray-200",children:(()=>{if(!R?.content)return null;return R.content.split("\n").filter(e=>e.trim()).map((s,t)=>{const r=s.substring(0,3),a=S[r]||{bg:"bg-white",text:"text-gray-600",border:"border-gray-100",label:r};return e.jsxs("div",{className:`flex items-start gap-2 px-3 py-1 ${a.bg} border-l-4 ${a.border}`,children:[e.jsx("span",{className:`shrink-0 w-20 text-xs font-semibold ${a.text} pt-0.5`,children:j(`euritmo.recordTypes.${r}`,a.label)}),e.jsx("pre",{className:"text-xs font-mono text-gray-700 whitespace-pre overflow-x-auto flex-1 leading-relaxed",children:s})]},t)})})()})}),R&&!N&&e.jsx("div",{className:"px-6 py-2 border-t border-gray-100",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(S).map(([s,t])=>e.jsxs("span",{className:`inline-flex items-center gap-1 px-2 py-0.5 rounded text-xs ${t.bg} ${t.text}`,children:[e.jsx("strong",{children:s})," ",j(`euritmo.recordTypes.${s}`,t.label)]},s))})}),e.jsxs("div",{className:"flex items-center justify-end gap-3 px-6 py-4 border-t border-gray-200 bg-gray-50 rounded-b-xl",children:[e.jsx("button",{onClick:g,className:"btn-secondary",children:j("common.close")}),e.jsxs("button",{onClick:async()=>{try{const e=await r.downloadBlob(`/ordini/${u}/euritmo`),s=window.URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download=R?.fileName||`ORDERS_${u}.edi`,t.click(),window.URL.revokeObjectURL(s),p.success(j("euritmo.downloadSuccess"))}catch{p.error(j("euritmo.downloadError"))}},disabled:!R||N,className:"btn-secondary flex items-center gap-2",children:[e.jsx(d,{className:"w-4 h-4"}),j("euritmo.download")]}),e.jsxs("button",{onClick:async()=>{const e=R?.sent,s=j(e?"euritmo.confirmResend":"euritmo.confirmSend");if(window.confirm(s)){k(!0);try{const e=await r.put(`/ordini/${u}/invia`);e?.success?(p.success(j("euritmo.sendSuccess")),$(s=>s?{...s,sent:!0,sentAt:e.data?.sentAt}:s),b?.()):p.error(e?.message||j("euritmo.sendError"))}catch(t){p.error(j("euritmo.sendError"))}finally{k(!1)}}},disabled:!R||N||v,className:"flex items-center gap-2 "+(R?.sent?"btn-secondary":"btn-primary"),children:[v?e.jsx(i,{className:"w-4 h-4 animate-spin"}):R?.sent?e.jsx(x,{className:"w-4 h-4"}):e.jsx(m,{className:"w-4 h-4"}),j(R?.sent?"euritmo.resend":"euritmo.send")]})]})]})}):null}const R={Carrello:"bg-gray-100 text-gray-700",Preventivo:"bg-blue-100 text-blue-700",Ordine:"bg-green-100 text-green-700"};function $(){const{t:t}=C(),o=a(),[x,S]=s.useState([]),[$,z]=s.useState(!0),[D,P]=s.useState(""),[O,T]=s.useState("tutti"),[A,E]=s.useState({carrello:0,preventivo:0,ordine:0}),[F,U]=s.useState(1),[I,L]=s.useState(1),[_,M]=s.useState(0),[q,B]=s.useState(null),[V,G]=s.useState(!1),[X,Z]=s.useState(null),[H,J]=s.useState({}),[K,Q]=s.useState(null),[W,Y]=s.useState(null),ee=s.useCallback(async()=>{z(!0);try{const e=new URLSearchParams({page:F.toString(),pageSize:"20",..."tutti"!==O&&{stato:O},...D&&{search:D}}),s=await r.get(`/ordini?${e}`);if(s?.success){const e=s.data;S(e.items||[]),L(e.totalPages||1),M(e.total||0),e.counts&&E(e.counts)}}catch(e){p.error(t("common.error"))}finally{z(!1)}},[F,O,D,t]);s.useEffect(()=>{ee()},[ee]),s.useEffect(()=>{U(1)},[O,D]);const se=async e=>{B(e),G(!0),Z(null),J({});try{const s=await r.get(`/ordini/${e}`);s?.success&&Z(s.data)}catch(s){p.error(t("common.error")),B(null)}finally{G(!1)}},te=()=>{B(null),Z(null)},re=async e=>{try{const s=await r.downloadBlob(`/ordini/${e}/pdf`),a=URL.createObjectURL(s),l=document.createElement("a");l.href=a;const n=X?.flagConferma?"ordine":"preventivo";l.download=`${n}_${e}.pdf`,l.click(),URL.revokeObjectURL(a),p.success(t("orders.pdfDownloaded"))}catch(s){p.error(t("common.error"))}},ae=[{key:"tutti",label:t("orders.allStatuses"),count:A.carrello+A.preventivo+A.ordine},{key:"Preventivo",label:t("orders.statusPreventivo"),count:A.preventivo},{key:"Ordine",label:t("orders.statusOrdine"),count:A.ordine},{key:"Carrello",label:t("orders.statusCarrello"),count:A.carrello}];return e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-3",children:[e.jsx(l,{className:"w-7 h-7"}),t("orders.title")]}),e.jsx("div",{className:"card p-4 mb-4",children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 justify-between items-start md:items-center",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:ae.map(s=>e.jsxs("button",{onClick:()=>T(s.key),className:"px-3 py-1.5 rounded-full text-sm font-medium transition-colors "+(O===s.key?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"),children:[s.label,e.jsxs("span",{className:"ml-1.5 text-xs opacity-75",children:["(",s.count,")"]})]},s.key))}),e.jsxs("div",{className:"relative w-full md:w-64",children:[e.jsx(u,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:D,onChange:e=>P(e.target.value),placeholder:t("orders.search"),className:"input-field w-full pl-9"})]})]})}),e.jsx("div",{className:"card overflow-hidden",children:$?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx(i,{className:"w-8 h-8 animate-spin text-blue-500"})}):0===x.length?e.jsxs("div",{className:"text-center py-12 text-gray-400",children:[e.jsx(h,{className:"w-12 h-12 mx-auto mb-3 opacity-50"}),e.jsx("p",{children:t("orders.noOrders")})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm","aria-label":t("a11y.tableCaption.orders"),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 border-b text-left text-xs text-gray-500 uppercase",children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:t("orders.number")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:t("orders.date")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:t("orders.status")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:t("orders.ragSoc")}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-right",children:t("orders.total")}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:t("orders.sent")}),e.jsx("th",{scope:"col",className:"px-4 py-3 text-center",children:t("cart.actions")})]})}),e.jsx("tbody",{className:"divide-y",children:x.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 font-medium",children:["#",s.ordNum]}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:o.date(s.ordData)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${R[s.stato]||""}`,children:s.stato})}),e.jsx("td",{className:"px-4 py-3",children:s.fattRagSoc||"â€”"}),e.jsx("td",{className:"px-4 py-3 text-right font-medium",children:o.currency(s.totale||0)}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.flagInvioFornitore?e.jsx(c,{className:"w-4 h-4 text-green-500 mx-auto"}):e.jsx("span",{className:"text-gray-300",children:"â€”"})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx("button",{onClick:()=>se(s.ordNum),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",title:t("orders.detail.title"),children:e.jsx(g,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>re(s.ordNum),className:"p-1.5 text-gray-600 hover:bg-gray-100 rounded",title:t("orders.printPdf"),children:e.jsx(d,{className:"w-4 h-4"})}),!s.flagConferma&&e.jsx("button",{onClick:()=>Q({type:"confirm",ordNum:s.ordNum}),className:"p-1.5 text-green-600 hover:bg-green-50 rounded",title:t("orders.confirm"),children:e.jsx(c,{className:"w-4 h-4"})}),s.flagConferma&&!s.flagInvioFornitore&&e.jsx("button",{onClick:()=>Q({type:"send",ordNum:s.ordNum}),className:"p-1.5 text-orange-600 hover:bg-orange-50 rounded",title:t("orders.sendSupplier"),children:e.jsx(m,{className:"w-4 h-4"})}),!s.flagConferma&&e.jsx("button",{onClick:()=>Q({type:"delete",ordNum:s.ordNum}),className:"p-1.5 text-red-500 hover:bg-red-50 rounded",title:t("common.delete"),children:e.jsx(b,{className:"w-4 h-4"})})]})})]},s.ordNum))})]})}),I>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t text-sm",children:[e.jsx("span",{className:"text-gray-500",children:t("orders.showing",{count:x.length,total:_})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>U(e=>Math.max(1,e-1)),disabled:1===F,className:"px-3 py-1 rounded border hover:bg-gray-50 disabled:opacity-40",children:"â†"}),e.jsxs("span",{className:"px-3 py-1",children:[F," / ",I]}),e.jsx("button",{onClick:()=>U(e=>Math.min(I,e+1)),disabled:F===I,className:"px-3 py-1 rounded border hover:bg-gray-50 disabled:opacity-40",children:"â†’"})]})]})]})}),q&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-start justify-center pt-10 overflow-y-auto",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl mx-4 mb-10",role:"dialog","aria-modal":"true","aria-labelledby":"order-detail-title",children:[e.jsxs("div",{className:"flex items-center justify-between p-5 border-b",children:[e.jsxs("h2",{id:"order-detail-title",className:"text-lg font-bold flex items-center gap-2",children:[e.jsx(l,{className:"w-5 h-5","aria-hidden":"true"}),t("orders.detail.title")," #",q,X&&e.jsx("span",{className:`ml-2 px-2 py-0.5 rounded-full text-xs font-medium ${R[X.stato]||""}`,children:X.stato})]}),e.jsx("button",{onClick:te,className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(n,{className:"w-5 h-5"})})]}),V?e.jsx("div",{className:"flex justify-center py-16",children:e.jsx(i,{className:"w-8 h-8 animate-spin text-blue-500"})}):X?e.jsxs("div",{className:"p-5 space-y-5",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-2",children:t("quote.invoiceData")}),e.jsx("p",{className:"font-medium",children:X.fattRagSoc}),e.jsx("p",{className:"text-sm text-gray-600",children:X.fattIndirizzo}),e.jsxs("p",{className:"text-sm text-gray-600",children:[X.fattCap," ",X.fattCitta," (",X.fattProvincia,")"]}),X.fattPIva&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["P.IVA: ",X.fattPIva]}),X.fattCFis&&e.jsxs("p",{className:"text-xs text-gray-500",children:["C.F.: ",X.fattCFis]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 mb-2",children:t("quote.deliveryData")}),e.jsx("p",{className:"font-medium",children:X.consRagSoc}),e.jsx("p",{className:"text-sm text-gray-600",children:X.consIndirizzo}),e.jsxs("p",{className:"text-sm text-gray-600",children:[X.consCap," ",X.consCitta," (",X.consProvincia,")"]})]})]}),(X.note||X.pagDescrizione)&&e.jsxs("div",{className:"flex gap-4 text-sm",children:[X.pagDescrizione&&e.jsxs("span",{className:"text-gray-500",children:[t("quote.payment"),": ",e.jsxs("strong",{children:[X.pagCod," - ",X.pagDescrizione]})]}),X.note&&e.jsxs("span",{className:"text-gray-500",children:[t("quote.notes"),": ",X.note]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm","aria-label":t("a11y.tableCaption.orderDetail"),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-100 text-left text-xs text-gray-500 uppercase",children:[e.jsx("th",{scope:"col",className:"px-3 py-2 w-8"}),e.jsx("th",{scope:"col",className:"px-3 py-2",children:t("cart.product")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-center",children:t("cart.um")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-center",children:t("cart.quantity")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-right",children:t("cart.unitPrice")}),e.jsx("th",{scope:"col",className:"px-3 py-2 text-right",children:t("cart.totalPrice")}),!X.flagConferma&&e.jsx("th",{className:"px-3 py-2 w-10"})]})}),e.jsx("tbody",{className:"divide-y",children:X.righe?.map((s,r)=>{const a=H[s.rigaNum];return e.jsx("tr",{children:e.jsx("td",{colSpan:X.flagConferma?6:7,className:"p-0",children:e.jsx("table",{className:"w-full",children:e.jsxs("tbody",{children:[e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 w-8",children:s.isConfigured&&e.jsx("button",{onClick:()=>{return e=s.rigaNum,void J(s=>({...s,[e]:!s[e]}));var e},className:"text-gray-400 hover:text-blue-600",children:a?e.jsx(j,{className:"w-4 h-4"}):e.jsx(f,{className:"w-4 h-4"})})}),e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:s.isConfigured?"font-medium":"",children:s.prdDes}),e.jsx("span",{className:"text-xs text-gray-400",children:s.prdCod}),s.isConfigured&&e.jsxs("span",{className:"inline-flex items-center text-xs bg-purple-100 text-purple-700 px-1.5 py-0.5 rounded",children:[e.jsx(y,{className:"w-3 h-3 mr-0.5"}),t("cart.configuredProduct")]}),e.jsxs("a",{href:`/alleg_documenti/${s.prdCod.replace(/ /g,"_")}_tools.pdf`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-0.5 text-xs text-orange-600 hover:text-orange-800 bg-orange-50 hover:bg-orange-100 px-1.5 py-0.5 rounded transition-colors",title:"PDF Tools",children:[e.jsx(N,{className:"w-3 h-3"})," Tools"]}),e.jsxs("a",{href:`/alleg_documenti/${s.prdCod.replace(/ /g,"_")}_sctec.pdf`,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-0.5 text-xs text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 px-1.5 py-0.5 rounded transition-colors",title:"Scheda Tecnica",children:[e.jsx(w,{className:"w-3 h-3"})," Scheda Tecnica"]})]})}),e.jsx("td",{className:"px-3 py-2 text-center text-gray-500",children:s.prdUm}),e.jsx("td",{className:"px-3 py-2 text-center",children:s.quantita}),e.jsx("td",{className:"px-3 py-2 text-right",children:s.isConfigured?"":o.currency(s.prezzoUnitario||0)}),e.jsx("td",{className:"px-3 py-2 text-right font-medium",children:o.currency(s.prezzoTotale||0)}),!X.flagConferma&&e.jsx("td",{className:"px-3 py-2 text-center",children:e.jsx("button",{onClick:()=>Q({type:"deleteRow",ordNum:X.ordNum,rigaNum:s.rigaNum}),className:"p-1 text-red-400 hover:text-red-600 rounded",children:e.jsx(b,{className:"w-3.5 h-3.5"})})})]}),s.isConfigured&&a&&s.config&&e.jsxs("tr",{className:"bg-purple-50",children:[e.jsx("td",{}),e.jsx("td",{colSpan:6,className:"px-3 py-2",children:e.jsxs("div",{className:"flex flex-wrap gap-3 text-xs text-purple-700",children:[e.jsx("span",{children:e.jsxs("strong",{children:[t("orders.configParams"),":"]})}),e.jsxs("span",{children:["ðŸ“ ",t("configurator.height"),": ",s.config.altezzaPali,"cm"]}),e.jsxs("span",{children:["ðŸŽ¨ ",t("configurator.slats"),": ",s.config.tipoDoghe]}),e.jsxs("span",{children:["ðŸ”© ",t("configurator.fixing"),": ",s.config.fissaggio]}),e.jsxs("span",{children:["ðŸŽ¯ ",t("configurator.colorSlats"),": ",s.config.coloreDoghe]}),!s.config.stessoColore&&e.jsxs("span",{children:["ðŸŽ¯ ",t("configurator.colorPoles"),": ",s.config.colorePali]}),e.jsxs("span",{children:["ðŸ“ ",t("configurator.sections"),": ",s.config.numeroSezioni]})]})})]}),s.isConfigured&&a&&s.componenti?.map((s,t)=>e.jsxs("tr",{className:"bg-blue-50/50 text-xs",children:[e.jsx("td",{}),e.jsxs("td",{className:"px-3 py-1.5 pl-10 text-gray-600",children:[e.jsx("span",{className:"text-gray-400 mr-1",children:"â””"}),s.prdDes,e.jsx("span",{className:"text-gray-400 ml-2",children:s.prdCod})]}),e.jsx("td",{className:"px-3 py-1.5 text-center text-gray-500",children:s.prdUm}),e.jsx("td",{className:"px-3 py-1.5 text-center text-gray-500",children:s.quantita}),e.jsx("td",{className:"px-3 py-1.5 text-right text-gray-500",children:o.currency(s.prezzoUnitario||0)}),e.jsx("td",{className:"px-3 py-1.5 text-right text-gray-600",children:o.currency(s.prezzoTotale||0)}),!X.flagConferma&&e.jsx("td",{})]},t))]})})})},s.rigaNum)})})]})}),e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-64 space-y-1 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-500",children:t("cart.subtotal")}),e.jsx("span",{children:o.currency(X.subtotale||0)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{className:"text-gray-500",children:[t("cart.vat")," (",X.aliquotaIVA,"%)"]}),e.jsx("span",{children:o.currency(X.importoIVA||0)})]}),e.jsx("hr",{}),e.jsxs("div",{className:"flex justify-between text-lg font-bold",children:[e.jsx("span",{children:t("cart.total")}),e.jsx("span",{children:o.currency(X.totale||0)})]})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 pt-2 border-t",children:[e.jsxs("button",{onClick:()=>re(X.ordNum),className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(d,{className:"w-4 h-4"})," ",t("orders.printPdf")]}),!X.flagConferma&&e.jsxs("button",{onClick:()=>Q({type:"confirm",ordNum:X.ordNum}),className:"btn-success flex items-center gap-1.5 text-sm",children:[e.jsx(c,{className:"w-4 h-4"})," ",t("orders.confirm")]}),X.flagConferma&&e.jsxs("button",{onClick:()=>Y(X.ordNum),className:"btn-secondary flex items-center gap-1.5 text-sm",children:[e.jsx(l,{className:"w-4 h-4"})," ",t("euritmo.preview")]}),X.flagConferma&&!X.flagInvioFornitore&&e.jsxs("button",{onClick:()=>Q({type:"send",ordNum:X.ordNum}),className:"btn-primary flex items-center gap-1.5 text-sm",children:[e.jsx(m,{className:"w-4 h-4"})," ",t("orders.sendSupplier")]}),!X.flagConferma&&e.jsxs("button",{onClick:()=>Q({type:"delete",ordNum:X.ordNum}),className:"btn-danger flex items-center gap-1.5 text-sm",children:[e.jsx(b,{className:"w-4 h-4"})," ",t("common.delete")]})]})]}):null]})}),e.jsx(k,{ordNum:W,isOpen:!!W,onClose:()=>Y(null),onSent:()=>{ee(),X&&se(W)}}),K&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-[60] flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-6 max-w-sm mx-4",role:"alertdialog","aria-modal":"true","aria-labelledby":"confirm-action-title",children:[e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx(v,{className:"w-6 h-6 text-amber-500 shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{id:"confirm-action-title",className:"font-semibold mb-1",children:t("orders.confirmAction")}),e.jsxs("p",{className:"text-sm text-gray-600",children:["confirm"===K.type&&t("orders.confirmOrderMessage"),"send"===K.type&&t("orders.confirmSendMessage"),"delete"===K.type&&t("orders.confirmDeleteMessage"),"deleteRow"===K.type&&t("orders.confirmDeleteRowMessage")]})]})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{onClick:()=>Q(null),className:"btn-secondary text-sm",children:t("common.cancel")}),e.jsx("button",{onClick:()=>{const{type:e,ordNum:s,rigaNum:a}=K;"confirm"===e?(async e=>{try{const s=await r.put(`/ordini/${e}/conferma`);s?.success&&(p.success(t("orders.confirmed")),ee(),X&&se(e))}catch(s){p.error(s.message||t("common.error"))}Q(null)})(s):"send"===e?(e=>{Q(null),Y(e)})(s):"delete"===e?(async e=>{try{const s=await r.del(`/ordini/${e}`);s?.success&&(p.success(t("orders.deleted")),te(),ee())}catch(s){p.error(s.message||t("common.error"))}Q(null)})(s):"deleteRow"===e&&(async(e,s)=>{try{const a=await r.del(`/ordini/${e}/righe/${s}`);a?.success&&(p.success(t("orders.rowDeleted")),se(e))}catch(a){p.error(a.message||t("common.error"))}Q(null)})(s,a)},className:"text-sm "+("delete"===K.type||"deleteRow"===K.type?"btn-danger":"btn-success"),children:t("common.confirm")})]})]})})]})}export{$ as default};
