<<<<<<<< HEAD:recinzioni-portal/backend/RecinzioniPortal.API/publish/wwwroot/assets/QuoteFormPage-Dl3eEoqy.js
import{j as a}from"./vendor-three-CHCIWYOy.js";import{c as e,r as t}from"./vendor-react-DmByJA4P.js";import{c as s,a as o}from"./index-Cu-EvGIq.js";import{u as i}from"./formatters-BFOEvdlG.js";import{z as r,V as c,F as n,Y as l,S as d,v as g}from"./vendor-ui-CwcPvQqL.js";import{u as m}from"./vendor-i18n-BveTNVnu.js";const p={fattRagSoc:"",fattIndirizzo:"",fattCap:"",fattCitta:"",fattProvincia:"",fattPIva:"",fattCFis:"",consRagSoc:"",consIndirizzo:"",consCap:"",consCitta:"",consProvincia:"",pagCod:"",pagDescrizione:"",note:""};function f(){const{t:f}=m(),u=e(),{items:x,getSubtotal:h,getVAT:v,getTotal:j,getItemCount:z,clear:C}=s(),q=i(),[N,y]=t.useState({...p}),[b,S]=t.useState(!1),[I,P]=t.useState({}),[w,D]=t.useState(!1),[R,F]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const a=await o.get("/ordini/dati-anagrafica");if(a?.success&&a?.data){const e=a.data;y(a=>({...a,fattRagSoc:e.fatturazione?.ragSoc||"",fattIndirizzo:e.fatturazione?.indirizzo||"",fattCap:e.fatturazione?.cap||"",fattCitta:e.fatturazione?.citta||"",fattProvincia:e.fatturazione?.provincia||"",fattPIva:e.fatturazione?.pIva||"",fattCFis:e.fatturazione?.cFis||"",consRagSoc:e.consegna?.ragSoc||"",consIndirizzo:e.consegna?.indirizzo||"",consCap:e.consegna?.cap||"",consCitta:e.consegna?.citta||"",consProvincia:e.consegna?.provincia||"",pagCod:e.pagamento||"",pagDescrizione:e.pagamento||""}))}}catch(a){}finally{F(!1)}})()},[]),t.useEffect(()=>{R||0!==x.length||(r.error(f("cart.emptyCartError")),u("/carrello"))},[R,x,u,f]),t.useEffect(()=>{b&&y(a=>({...a,consRagSoc:a.fattRagSoc,consIndirizzo:a.fattIndirizzo,consCap:a.fattCap,consCitta:a.fattCitta,consProvincia:a.fattProvincia}))},[b,N.fattRagSoc,N.fattIndirizzo,N.fattCap,N.fattCitta,N.fattProvincia]);const U=(a,e)=>{y(t=>({...t,[a]:e})),I[a]&&P(e=>({...e,[a]:null}))},k=(e,t,s={})=>{const{placeholder:o,maxLength:i,disabled:r,uppercase:c}=s;return a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:e}),a.jsx("input",{type:"text",value:N[t]||"",onChange:a=>{let e=a.target.value;c&&(e=e.toUpperCase()),U(t,e)},placeholder:o,maxLength:i,disabled:r,className:`input-field w-full ${I[t]?"border-red-500 ring-1 ring-red-300":""} ${r?"bg-gray-100":""}`}),I[t]&&a.jsxs("p",{className:"text-xs text-red-500 mt-0.5 flex items-center gap-1",children:[a.jsx(g,{className:"w-3 h-3"})," ",I[t]]})]})};return R?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx(c,{className:"w-8 h-8 animate-spin text-blue-500"})}):a.jsxs("div",{className:"max-w-5xl mx-auto",children:[a.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-3",children:[a.jsx(n,{className:"w-7 h-7"}),f("quote.title")]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"card p-5",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:f("quote.invoiceData")}),a.jsxs("div",{className:"space-y-3",children:[k(f("quote.ragSoc"),"fattRagSoc"),k(f("quote.address"),"fattIndirizzo"),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[k(f("quote.cap"),"fattCap",{maxLength:5,placeholder:"00000"}),k(f("quote.city"),"fattCitta"),k(f("quote.province"),"fattProvincia",{maxLength:2,uppercase:!0,placeholder:"XX"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[k(f("quote.piva"),"fattPIva",{maxLength:13,placeholder:"IT00000000000"}),k(f("quote.cfis"),"fattCFis",{maxLength:16,uppercase:!0})]})]})]}),a.jsxs("div",{className:"card p-5",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:f("quote.deliveryData")}),a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b,onChange:a=>S(a.target.checked),className:"rounded border-gray-300"}),a.jsx(l,{className:"w-3.5 h-3.5"}),f("quote.sameAsInvoice")]})]}),a.jsxs("div",{className:"space-y-3",children:[k(f("quote.ragSoc"),"consRagSoc",{disabled:b}),k(f("quote.address"),"consIndirizzo",{disabled:b}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[k(f("quote.cap"),"consCap",{maxLength:5,placeholder:"00000",disabled:b}),k(f("quote.city"),"consCitta",{disabled:b}),k(f("quote.province"),"consProvincia",{maxLength:2,uppercase:!0,placeholder:"XX",disabled:b})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[a.jsxs("div",{className:"card p-5",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:f("quote.payment")}),a.jsxs("div",{className:"space-y-3",children:[k(f("quote.paymentCode"),"pagCod"),k(f("quote.paymentDesc"),"pagDescrizione")]})]}),a.jsxs("div",{className:"card p-5",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:f("quote.notes")}),a.jsx("textarea",{value:N.note,onChange:a=>U("note",a.target.value),placeholder:f("quote.notesPlaceholder"),rows:4,className:"input-field w-full resize-none"})]})]}),a.jsx("div",{className:"mt-6 card p-5",children:a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[a.jsx(d,{className:"w-5 h-5 text-blue-500"}),a.jsxs("span",{children:[f("quote.cartSummary"),": ",a.jsx("strong",{children:z()})," ",f("quote.itemsCount")]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("span",{children:[f("cart.subtotal"),": ",a.jsx("strong",{children:q.currency(h())})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("span",{children:[f("cart.vat"),": ",a.jsx("strong",{children:q.currency(v())})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("span",{className:"text-lg font-bold",children:[f("cart.total"),": ",q.currency(j())]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>u("/carrello"),className:"btn-secondary",children:f("common.back")}),a.jsxs("button",{onClick:async()=>{if((()=>{const a={};return(!N.fattRagSoc||N.fattRagSoc.length<3)&&(a.fattRagSoc=f("quote.validation.ragSocMin")),N.fattIndirizzo||(a.fattIndirizzo=f("quote.validation.required")),N.fattCap&&!/^\d{5}$/.test(N.fattCap)&&(a.fattCap=f("quote.validation.capFormat")),N.fattCitta||(a.fattCitta=f("quote.validation.required")),N.fattProvincia&&!/^[A-Z]{2}$/i.test(N.fattProvincia)&&(a.fattProvincia=f("quote.validation.provinciaFormat")),N.fattPIva&&!/^(IT)?\d{11}$/.test(N.fattPIva.replace(/\s/g,""))&&(a.fattPIva=f("quote.validation.pivaFormat")),N.fattCFis&&!/^[A-Z0-9]{16}$/i.test(N.fattCFis.replace(/\s/g,""))&&(a.fattCFis=f("quote.validation.cfisFormat")),b||((!N.consRagSoc||N.consRagSoc.length<3)&&(a.consRagSoc=f("quote.validation.ragSocMin")),N.consIndirizzo||(a.consIndirizzo=f("quote.validation.required")),N.consCitta||(a.consCitta=f("quote.validation.required"))),P(a),0===Object.keys(a).length})()){D(!0);try{const a={...N,items:x.map(a=>({prdCod:a.prdCod,prdDes:a.prdDes,prdUm:a.prdUm,quantita:a.quantita,prezzoUnitario:a.prezzoUnitario,isConfigured:a.isConfigured||!1,componenti:a.componenti?.map(a=>({prdCod:a.prdCod,prdDes:a.prdDes,prdUm:a.prdUm,quantita:a.quantita,prezzoUnitario:a.prezzoUnitario,prezzoTotale:a.prezzoTotale}))||null,config:a.config?{coloreDoghe:a.config.coloreDoghe,colorePali:a.config.colorePali,stessoColore:a.config.stessoColore,fissaggio:a.config.fissaggio,tipoDoghe:a.config.tipoDoghe,altezzaPali:a.config.altezzaPali,numeroDoghe:a.config.numeroDoghe,numeroSezioni:a.config.sezioni?.length||a.config.numeroSezioni,sezioniJson:a.config.sezioni?JSON.stringify(a.config.sezioni):null}:null}))},e=await o.post("/ordini",a);if(e?.success)C(),r.success(f("quote.savedSuccess")),u("/ordini");else{const a=e?.message||e?.title||f("common.error"),t=e?.errors;if(t){const e=Object.values(t).flat().join("; ");r.error(`${a}: ${e}`,{duration:6e3})}else r.error(a,{duration:6e3})}}catch(a){r.error(a.message||f("common.error"))}finally{D(!1)}}else r.error(f("quote.validation.fixErrors"))},disabled:w,className:"btn-success flex items-center gap-2",children:[w?a.jsx(c,{className:"w-4 h-4 animate-spin"}):a.jsx(n,{className:"w-4 h-4"}),f("quote.saveQuote")]})]})]})})]})}export{f as default};
========
import{j as a}from"./vendor-three-CHCIWYOy.js";import{c as e,r as t}from"./vendor-react-DmByJA4P.js";import{c as s,a as o}from"./index-CJimMkjr.js";import{u as i}from"./formatters-BFOEvdlG.js";import{z as r,V as c,F as n,Y as l,S as d,v as g}from"./vendor-ui-CwcPvQqL.js";import{u as m}from"./vendor-i18n-BveTNVnu.js";const p={fattRagSoc:"",fattIndirizzo:"",fattCap:"",fattCitta:"",fattProvincia:"",fattPIva:"",fattCFis:"",consRagSoc:"",consIndirizzo:"",consCap:"",consCitta:"",consProvincia:"",pagCod:"",pagDescrizione:"",note:""};function f(){const{t:f}=m(),u=e(),{items:x,getSubtotal:h,getVAT:v,getTotal:j,getItemCount:z,clear:C}=s(),q=i(),[N,y]=t.useState({...p}),[b,S]=t.useState(!1),[I,P]=t.useState({}),[w,D]=t.useState(!1),[R,F]=t.useState(!0);t.useEffect(()=>{(async()=>{try{const a=await o.get("/ordini/dati-anagrafica");if(a?.success&&a?.data){const e=a.data;y(a=>({...a,fattRagSoc:e.fatturazione?.ragSoc||"",fattIndirizzo:e.fatturazione?.indirizzo||"",fattCap:e.fatturazione?.cap||"",fattCitta:e.fatturazione?.citta||"",fattProvincia:e.fatturazione?.provincia||"",fattPIva:e.fatturazione?.pIva||"",fattCFis:e.fatturazione?.cFis||"",consRagSoc:e.consegna?.ragSoc||"",consIndirizzo:e.consegna?.indirizzo||"",consCap:e.consegna?.cap||"",consCitta:e.consegna?.citta||"",consProvincia:e.consegna?.provincia||"",pagCod:e.pagamento||"",pagDescrizione:e.pagamento||""}))}}catch(a){}finally{F(!1)}})()},[]),t.useEffect(()=>{R||0!==x.length||(r.error(f("cart.emptyCartError")),u("/carrello"))},[R,x,u,f]),t.useEffect(()=>{b&&y(a=>({...a,consRagSoc:a.fattRagSoc,consIndirizzo:a.fattIndirizzo,consCap:a.fattCap,consCitta:a.fattCitta,consProvincia:a.fattProvincia}))},[b,N.fattRagSoc,N.fattIndirizzo,N.fattCap,N.fattCitta,N.fattProvincia]);const U=(a,e)=>{y(t=>({...t,[a]:e})),I[a]&&P(e=>({...e,[a]:null}))},k=(e,t,s={})=>{const{placeholder:o,maxLength:i,disabled:r,uppercase:c}=s;return a.jsxs("div",{children:[a.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:e}),a.jsx("input",{type:"text",value:N[t]||"",onChange:a=>{let e=a.target.value;c&&(e=e.toUpperCase()),U(t,e)},placeholder:o,maxLength:i,disabled:r,className:`input-field w-full ${I[t]?"border-red-500 ring-1 ring-red-300":""} ${r?"bg-gray-100":""}`}),I[t]&&a.jsxs("p",{className:"text-xs text-red-500 mt-0.5 flex items-center gap-1",children:[a.jsx(g,{className:"w-3 h-3"})," ",I[t]]})]})};return R?a.jsx("div",{className:"flex items-center justify-center py-20",children:a.jsx(c,{className:"w-8 h-8 animate-spin text-blue-500"})}):a.jsxs("div",{className:"max-w-5xl mx-auto",children:[a.jsxs("h1",{className:"text-2xl font-bold mb-6 flex items-center gap-3",children:[a.jsx(n,{className:"w-7 h-7"}),f("quote.title")]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[a.jsxs("div",{className:"card p-5",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:f("quote.invoiceData")}),a.jsxs("div",{className:"space-y-3",children:[k(f("quote.ragSoc"),"fattRagSoc"),k(f("quote.address"),"fattIndirizzo"),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[k(f("quote.cap"),"fattCap",{maxLength:5,placeholder:"00000"}),k(f("quote.city"),"fattCitta"),k(f("quote.province"),"fattProvincia",{maxLength:2,uppercase:!0,placeholder:"XX"})]}),a.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[k(f("quote.piva"),"fattPIva",{maxLength:13,placeholder:"IT00000000000"}),k(f("quote.cfis"),"fattCFis",{maxLength:16,uppercase:!0})]})]})]}),a.jsxs("div",{className:"card p-5",children:[a.jsxs("div",{className:"flex items-center justify-between mb-4",children:[a.jsx("h2",{className:"text-lg font-semibold text-gray-700",children:f("quote.deliveryData")}),a.jsxs("label",{className:"flex items-center gap-2 text-sm text-gray-600 cursor-pointer",children:[a.jsx("input",{type:"checkbox",checked:b,onChange:a=>S(a.target.checked),className:"rounded border-gray-300"}),a.jsx(l,{className:"w-3.5 h-3.5"}),f("quote.sameAsInvoice")]})]}),a.jsxs("div",{className:"space-y-3",children:[k(f("quote.ragSoc"),"consRagSoc",{disabled:b}),k(f("quote.address"),"consIndirizzo",{disabled:b}),a.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[k(f("quote.cap"),"consCap",{maxLength:5,placeholder:"00000",disabled:b}),k(f("quote.city"),"consCitta",{disabled:b}),k(f("quote.province"),"consProvincia",{maxLength:2,uppercase:!0,placeholder:"XX",disabled:b})]})]})]})]}),a.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6",children:[a.jsxs("div",{className:"card p-5",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:f("quote.payment")}),a.jsxs("div",{className:"space-y-3",children:[k(f("quote.paymentCode"),"pagCod"),k(f("quote.paymentDesc"),"pagDescrizione")]})]}),a.jsxs("div",{className:"card p-5",children:[a.jsx("h2",{className:"text-lg font-semibold mb-4 text-gray-700",children:f("quote.notes")}),a.jsx("textarea",{value:N.note,onChange:a=>U("note",a.target.value),placeholder:f("quote.notesPlaceholder"),rows:4,className:"input-field w-full resize-none"})]})]}),a.jsx("div",{className:"mt-6 card p-5",children:a.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4",children:[a.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[a.jsx(d,{className:"w-5 h-5 text-blue-500"}),a.jsxs("span",{children:[f("quote.cartSummary"),": ",a.jsx("strong",{children:z()})," ",f("quote.itemsCount")]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("span",{children:[f("cart.subtotal"),": ",a.jsx("strong",{children:q.currency(h())})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("span",{children:[f("cart.vat"),": ",a.jsx("strong",{children:q.currency(v())})]}),a.jsx("span",{className:"text-gray-300",children:"|"}),a.jsxs("span",{className:"text-lg font-bold",children:[f("cart.total"),": ",q.currency(j())]})]}),a.jsxs("div",{className:"flex gap-3",children:[a.jsx("button",{onClick:()=>u("/carrello"),className:"btn-secondary",children:f("common.back")}),a.jsxs("button",{onClick:async()=>{if((()=>{const a={};return(!N.fattRagSoc||N.fattRagSoc.length<3)&&(a.fattRagSoc=f("quote.validation.ragSocMin")),N.fattIndirizzo||(a.fattIndirizzo=f("quote.validation.required")),N.fattCap&&!/^\d{5}$/.test(N.fattCap)&&(a.fattCap=f("quote.validation.capFormat")),N.fattCitta||(a.fattCitta=f("quote.validation.required")),N.fattProvincia&&!/^[A-Z]{2}$/i.test(N.fattProvincia)&&(a.fattProvincia=f("quote.validation.provinciaFormat")),N.fattPIva&&!/^(IT)?\d{11}$/.test(N.fattPIva.replace(/\s/g,""))&&(a.fattPIva=f("quote.validation.pivaFormat")),N.fattCFis&&!/^[A-Z0-9]{16}$/i.test(N.fattCFis.replace(/\s/g,""))&&(a.fattCFis=f("quote.validation.cfisFormat")),b||((!N.consRagSoc||N.consRagSoc.length<3)&&(a.consRagSoc=f("quote.validation.ragSocMin")),N.consIndirizzo||(a.consIndirizzo=f("quote.validation.required")),N.consCitta||(a.consCitta=f("quote.validation.required"))),P(a),0===Object.keys(a).length})()){D(!0);try{const a={...N,items:x.map(a=>({prdCod:a.prdCod,prdDes:a.prdDes,prdUm:a.prdUm,quantita:a.quantita,prezzoUnitario:a.prezzoUnitario,isConfigured:a.isConfigured||!1,componenti:a.componenti?.map(a=>({prdCod:a.prdCod,prdDes:a.prdDes,prdUm:a.prdUm,quantita:a.quantita,prezzoUnitario:a.prezzoUnitario,prezzoTotale:a.prezzoTotale}))||null,config:a.config?{coloreDoghe:a.config.coloreDoghe,colorePali:a.config.colorePali,stessoColore:a.config.stessoColore,fissaggio:a.config.fissaggio,tipoDoghe:a.config.tipoDoghe,altezzaPali:a.config.altezzaPali,numeroDoghe:a.config.numeroDoghe,numeroSezioni:a.config.sezioni?.length||a.config.numeroSezioni,sezioniJson:a.config.sezioni?JSON.stringify(a.config.sezioni):null}:null}))},e=await o.post("/ordini",a);if(e?.success)C(),r.success(f("quote.savedSuccess")),u("/ordini");else{const a=e?.message||e?.title||f("common.error"),t=e?.errors;if(t){const e=Object.values(t).flat().join("; ");r.error(`${a}: ${e}`,{duration:6e3})}else r.error(a,{duration:6e3})}}catch(a){r.error(a.message||f("common.error"))}finally{D(!1)}}else r.error(f("quote.validation.fixErrors"))},disabled:w,className:"btn-success flex items-center gap-2",children:[w?a.jsx(c,{className:"w-4 h-4 animate-spin"}):a.jsx(n,{className:"w-4 h-4"}),f("quote.saveQuote")]})]})]})})]})}export{f as default};
>>>>>>>> ea80cea9b79503a546cd03b73894133566df663e:recinzioni-portal/backend/RecinzioniPortal.API/publish/wwwroot/assets/QuoteFormPage-DzMH5n1R.js
