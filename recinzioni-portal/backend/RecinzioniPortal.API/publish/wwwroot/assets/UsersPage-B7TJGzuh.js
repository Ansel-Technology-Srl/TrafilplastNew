import{j as e}from"./vendor-three-CHCIWYOy.js";import{r as s}from"./vendor-react-DmByJA4P.js";import{a as t}from"./index-DG0WW0gK.js";import{i as a,D as l,a as r,m as c,a1 as i,w as n,X as d,z as o}from"./vendor-ui-CwcPvQqL.js";import{u as m}from"./vendor-i18n-BveTNVnu.js";const x={1:"Administrator",2:"Super User Cliente",3:"Capo Negozio",4:"Operatore Semplice"};function u(){const{t:u}=m(),[p,h]=s.useState([]),[j,g]=s.useState(!0),[b,N]=s.useState(""),[f,y]=s.useState(null),[v,w]=s.useState(null),[I,D]=s.useState({userID:"",userLogin:"",password:"",userName:"",userType:4,mailAddress:"",itemID:"",itemIDSede:""});s.useEffect(()=>{C()},[]);const C=async()=>{g(!0);const e=b?`?search=${b}`:"",s=await t.get(`/utenti${e}`);s?.success&&h(s.data),g(!1)},k=(e,s)=>D(t=>({...t,[e]:s}));return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold",children:u("users.title")}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{onClick:()=>{D({userID:"",userLogin:"",password:"",userName:"",userType:4,mailAddress:"",itemID:"",itemIDSede:""}),y("create")},className:"btn-primary flex items-center gap-1 text-sm",children:[e.jsx(a,{size:16})," ",u("users.add")]}),e.jsxs("button",{onClick:async()=>{const e=await t.downloadBlob("/utenti/export");if(e){const s=URL.createObjectURL(e),t=document.createElement("a");t.href=s,t.download="utenti_export.xlsx",t.click(),URL.revokeObjectURL(s)}},className:"btn-secondary flex items-center gap-1 text-sm",children:[e.jsx(l,{size:16})," ",u("users.export")]}),e.jsxs("label",{className:"btn-secondary flex items-center gap-1 text-sm cursor-pointer",children:[e.jsx(r,{size:16})," ",u("users.import"),e.jsx("input",{type:"file",accept:".xlsx,.csv",onChange:async e=>{const s=e.target.files?.[0];if(!s)return;const a=await t.upload("/utenti/import",s,{mode:"merge"});a&&(o.success(`Importati: ${a.righeImportate}/${a.totaleRighe}`),a.errori?.length>0&&o.error(`${a.righeErrore} errori`),C()),e.target.value=""},className:"hidden"})]})]})]}),e.jsx("div",{className:"card mb-6",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),C()},className:"flex gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(c,{className:"absolute left-3 top-2.5 text-gray-400",size:20}),e.jsx("input",{type:"text",value:b,onChange:e=>N(e.target.value),placeholder:u("users.search"),className:"input-field pl-10"})]}),e.jsx("button",{type:"submit",className:"btn-primary",children:"Cerca"})]})}),e.jsx("div",{className:"card p-0 overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm","aria-label":u("a11y.tableCaption.users"),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left text-gray-600",children:[e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.id")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.login")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.name")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.type")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.email")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.client")}),e.jsx("th",{scope:"col",className:"px-4 py-3",children:u("users.branch")}),e.jsx("th",{scope:"col",className:"px-4 py-3 w-24",children:u("common.actions")})]})}),e.jsx("tbody",{children:j?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-gray-400",children:u("app.loading")})}):0===p.length?e.jsx("tr",{children:e.jsx("td",{colSpan:"8",className:"text-center py-8 text-gray-400",children:u("common.noData")})}):p.map(s=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3 font-mono",children:s.userID}),e.jsx("td",{className:"px-4 py-3",children:s.userLogin}),e.jsx("td",{className:"px-4 py-3 font-medium",children:s.userName}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-gray-100",children:x[s.userType]})}),e.jsx("td",{className:"px-4 py-3 text-gray-500",children:s.mailAddress}),e.jsx("td",{className:"px-4 py-3 font-mono text-xs",children:s.itemID}),e.jsx("td",{className:"px-4 py-3 font-mono text-xs",children:s.itemIDSede}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>{return w(e=s),D({...e,password:""}),void y("edit");var e},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",children:e.jsx(i,{size:15})}),e.jsx("button",{onClick:()=>(async e=>{if(!window.confirm(u("users.confirmDelete")))return;const s=await t.del(`/utenti/${e}`);s?.success?(o.success("Utente eliminato"),C()):o.error(s?.message||"Errore")})(s.userID),className:"p-1.5 text-red-500 hover:bg-red-50 rounded",children:e.jsx(n,{size:15})})]})})]},s.userID))})]})}),f&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b",children:[e.jsx("h3",{className:"font-semibold text-lg",children:u("create"===f?"users.add":"users.edit")}),e.jsx("button",{onClick:()=>y(null),className:"p-1 hover:bg-gray-100 rounded",children:e.jsx(d,{size:20})})]}),e.jsxs("div",{className:"p-4 space-y-4",children:["create"===f&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"UserID *"}),e.jsx("input",{type:"number",value:I.userID,onChange:e=>k("userID",e.target.value),className:"input-field"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Login *"}),e.jsx("input",{type:"text",value:I.userLogin||"",onChange:e=>k("userLogin",e.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-1",children:["Password ","edit"===f?"(lascia vuoto per non cambiare)":"*"]}),e.jsx("input",{type:"password",value:I.password||"",onChange:e=>k("password",e.target.value),className:"input-field"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Nome completo *"}),e.jsx("input",{type:"text",value:I.userName||"",onChange:e=>k("userName",e.target.value),className:"input-field"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Tipo *"}),e.jsx("select",{value:I.userType,onChange:e=>k("userType",e.target.value),className:"input-field",children:Object.entries(x).map(([s,t])=>e.jsx("option",{value:s,children:t},s))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Email"}),e.jsx("input",{type:"email",value:I.mailAddress||"",onChange:e=>k("mailAddress",e.target.value),className:"input-field"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Codice Cliente (ItemID)"}),e.jsx("input",{type:"text",value:I.itemID||"",onChange:e=>k("itemID",e.target.value),className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Codice Sede (ItemIDSede)"}),e.jsx("input",{type:"text",value:I.itemIDSede||"",onChange:e=>k("itemIDSede",e.target.value),className:"input-field"})]})]})]}),e.jsxs("div",{className:"flex justify-end gap-3 p-4 border-t",children:[e.jsx("button",{onClick:()=>y(null),className:"btn-secondary",children:u("common.cancel")}),e.jsx("button",{onClick:async()=>{if("create"===f){const e=await t.post("/utenti",{...I,userID:parseInt(I.userID),userType:parseInt(I.userType)});e?.success?(o.success("Utente creato"),y(null),C()):o.error(e?.message||"Errore")}else{const e={...I,userType:parseInt(I.userType)};e.password||delete e.password;const s=await t.put(`/utenti/${v.userID}`,e);s?.success?(o.success("Utente aggiornato"),y(null),C()):o.error(s?.message||"Errore")}},className:"btn-primary",children:u("common.save")})]})]})})]})}export{u as default};
