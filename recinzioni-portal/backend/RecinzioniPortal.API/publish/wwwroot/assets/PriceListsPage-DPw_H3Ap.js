import{j as e}from"./vendor-three-CHCIWYOy.js";import{r as s}from"./vendor-react-DmByJA4P.js";import{a as t}from"./index-DG0WW0gK.js";import{u as a}from"./formatters-BFOEvdlG.js";import{a3 as i,R as r,T as l,a7 as c,a8 as n,w as o,a9 as d,m,aa as x,ab as p,Q as u,t as h,X as g,ac as j,C as y,o as f,i as b,z as N}from"./vendor-ui-CwcPvQqL.js";import{u as v}from"./vendor-i18n-BveTNVnu.js";function C(){const{t:a}=v(),[r,l]=s.useState([]),[c,n]=s.useState(null),[o,d]=s.useState(!0);s.useEffect(()=>{m()},[]);const m=async()=>{d(!0);const e=await t.get("/listini/puntivendita");e?.success&&l(e.data),d(!1)},x=()=>{m(),n(null)};return e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:a("priceLists.title")})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsx("div",{className:"lg:col-span-4 xl:col-span-3",children:e.jsx(w,{pdvList:r,loading:o,selectedPdv:c,onSelect:e=>{n(e)}})}),e.jsx("div",{className:"lg:col-span-8 xl:col-span-9",children:c?c.hasCustomList?e.jsx(S,{pdv:c,onRefresh:x}):e.jsx(L,{pdv:c,onCreated:x}):e.jsxs("div",{className:"card text-center py-16 text-gray-400",children:[e.jsx(i,{className:"mx-auto mb-3 text-gray-300",size:40}),e.jsx("p",{className:"text-lg",children:a("priceLists.selectBranch")}),e.jsx("p",{className:"text-sm mt-1",children:a("priceLists.selectBranchHint")})]})})]})]})}function w({pdvList:s,loading:t,selectedPdv:a,onSelect:c}){const{t:n}=v();return t?e.jsxs("div",{className:"card text-center py-8 text-gray-400",children:[e.jsx(r,{className:"animate-spin mx-auto mb-2",size:20})," ",n("app.loading")]}):0===s.length?e.jsx("div",{className:"card text-center py-8 text-gray-400",children:n("priceLists.noBranches")}):e.jsx("div",{className:"space-y-2",children:s.map(s=>{const t=a?.itemIDSede===s.itemIDSede;return e.jsx("button",{onClick:()=>c(s),className:"w-full text-left p-4 rounded-xl border-2 transition-all "+(t?"border-primary-500 bg-primary-50 shadow-sm":"border-gray-100 bg-white hover:border-gray-300 hover:shadow-sm"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg flex-shrink-0 "+(t?"bg-primary-100 text-primary-600":"bg-gray-100 text-gray-500"),children:e.jsx(i,{size:18})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm truncate",children:s.itemDes||s.itemIDSede}),s.loc&&e.jsxs("p",{className:"text-xs text-gray-500 truncate",children:[s.loc,s.pro?` (${s.pro})`:""]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[s.hasCustomList?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full "+(s.customIsValid?"bg-green-100 text-green-700":"bg-yellow-100 text-yellow-700"),children:[e.jsx(l,{size:10}),s.customIsValid?n("priceLists.customActive"):n("priceLists.customExpired")]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs px-2 py-0.5 rounded-full bg-gray-100 text-gray-600",children:[e.jsx(l,{size:10})," ",n("priceLists.publicOnly")]}),e.jsxs("span",{className:"text-xs text-gray-400",children:[s.numPrezziPubb," ",n("priceLists.items")]})]})]})]})},s.itemIDSede)})})}function L({pdv:a,onCreated:i}){const{t:l}=v(),[c,n]=s.useState([]),[o,d]=s.useState(!1),[x,p]=s.useState(""),[u,g]=s.useState(1),[j,y]=s.useState(null),[f,C]=s.useState(!1),[w,L]=s.useState(!1),[S,P]=s.useState((new Date).toISOString().split("T")[0]),[D,k]=s.useState(new Date(Date.now()+31536e6).toISOString().split("T")[0]);s.useEffect(()=>{I()},[a.lstCodPubb,u]);const I=async()=>{if(!a.lstCodPubb)return;d(!0);const e=new URLSearchParams({page:String(u),pageSize:"50"});x&&e.set("search",x);const s=await t.get(`/listini/${encodeURIComponent(a.lstCodPubb)}?${e}`);s?.success&&(n(s.data),y(s.pagination)),d(!1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card bg-blue-50 border border-blue-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-blue-900",children:a.itemDes||a.itemIDSede}),e.jsxs("p",{className:"text-sm text-blue-700 mt-1",children:[l("priceLists.publicListCode"),": ",e.jsx("span",{className:"font-mono",children:a.lstCodPubb||"—"})]})]}),e.jsxs("button",{onClick:()=>C(!f),className:"btn-primary flex items-center gap-2 text-sm whitespace-nowrap",children:[e.jsx(b,{size:16})," ",l("priceLists.createCustom")]})]}),f&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-blue-200",children:[e.jsx("p",{className:"text-sm text-blue-800 mb-3",children:l("priceLists.createHint")}),e.jsxs("div",{className:"flex flex-wrap items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:l("priceLists.validFrom")}),e.jsx("input",{type:"date",value:S,onChange:e=>P(e.target.value),className:"input-field text-sm w-40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-blue-700 mb-1",children:l("priceLists.validTo")}),e.jsx("input",{type:"date",value:D,onChange:e=>k(e.target.value),className:"input-field text-sm w-40"})]}),e.jsxs("button",{onClick:async()=>{L(!0);const e=await t.post(`/listini/crea/${a.itemIDSede}`,{validoDal:S,validoAl:D});e?.success?(N.success(l("priceLists.created")),i()):N.error(e?.message||l("common.error")),L(!1)},disabled:w,className:"btn-success flex items-center gap-2 text-sm",children:[w?e.jsx(r,{className:"animate-spin",size:15}):e.jsx(h,{size:15}),l("priceLists.confirmCreate")]}),e.jsx("button",{onClick:()=>C(!1),className:"btn-secondary text-sm",children:l("common.cancel")})]})]})]}),e.jsxs("form",{onSubmit:e=>{e.preventDefault(),g(1),I()},className:"flex gap-2",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",value:x,onChange:e=>p(e.target.value),placeholder:l("priceLists.searchPlaceholder"),className:"input-field pl-10 text-sm"})]}),e.jsx("button",{type:"submit",className:"btn-primary text-sm",children:l("import.searchBtn")})]}),e.jsx(z,{data:c,loading:o,pagination:j,page:u,setPage:g,readOnly:!0})]})}function S({pdv:i,onRefresh:l}){const{t:b}=v(),C=a(),[w,L]=s.useState([]),[S,z]=s.useState(!1),[P,D]=s.useState(""),[k,I]=s.useState("all"),[U,M]=s.useState(1),[R,T]=s.useState(null),[$,A]=s.useState(null),[V,B]=s.useState(null),[E,O]=s.useState(""),[F,H]=s.useState(!1),[K,Q]=s.useState(!1),[q,G]=s.useState(i.customValidoDal?.split("T")[0]||""),[J,W]=s.useState(i.customValidoAl?.split("T")[0]||""),X=s.useRef(null);s.useEffect(()=>{Y()},[i.itemIDSede,U,k]);const Y=async()=>{z(!0);const e=new URLSearchParams({page:String(U),pageSize:"50"});P&&e.set("search",P),"all"!==k&&e.set("filter",k);const s=await t.get(`/listini/confronto/${i.itemIDSede}?${e}`);s?.success&&(L(s.data),T(s.pagination),A(s.summary)),z(!1)},Z=()=>{B(null),O("")},_=async e=>{const s=parseFloat(E);if(isNaN(s)||s<0)return void N.error(b("priceLists.invalidPrice"));H(!0);const a=await t.put(`/listini/${encodeURIComponent(i.customLstCod)}/prezzo`,{prdCod:e,nuovoPrezzo:s});a?.success?(N.success(b("priceLists.priceUpdated")),B(null),Y()):N.error(a?.message||b("common.error")),H(!1)};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"font-semibold text-gray-900",children:i.itemDes||i.itemIDSede}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[b("priceLists.customListCode"),": ",e.jsx("span",{className:"font-mono text-primary-600",children:i.customLstCod})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[e.jsx(c,{size:14,className:"text-gray-400"}),e.jsxs("span",{className:"text-sm "+(i.customIsValid?"text-green-600":"text-red-500"),children:[q||i.customValidoDal?.split("T")[0]," → ",J||i.customValidoAl?.split("T")[0]]}),e.jsx("button",{onClick:()=>Q(!K),className:"text-xs text-primary-600 hover:underline ml-1",children:b("priceLists.editDates")})]})]}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:async()=>{if(!window.confirm(b("priceLists.confirmReset")))return;const e=await t.post(`/listini/${encodeURIComponent(i.customLstCod)}/reset`);e?.success?(N.success(e.message),Y()):N.error(e?.message||b("common.error"))},className:"btn-secondary flex items-center gap-1.5 text-xs",children:[e.jsx(n,{size:14})," ",b("priceLists.resetAll")]}),e.jsxs("button",{onClick:async()=>{if(!window.confirm(b("priceLists.confirmDelete")))return;const e=await t.del(`/listini/${encodeURIComponent(i.customLstCod)}`);e?.success?(N.success(e.message),l()):N.error(e?.message||b("common.error"))},className:"text-red-600 hover:bg-red-50 px-3 py-1.5 rounded-lg text-xs font-medium flex items-center gap-1.5 transition-colors",children:[e.jsx(o,{size:14})," ",b("priceLists.deleteList")]})]})]}),K&&e.jsxs("div",{className:"mt-4 pt-4 border-t flex flex-wrap items-end gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:b("priceLists.validFrom")}),e.jsx("input",{type:"date",value:q,onChange:e=>G(e.target.value),className:"input-field text-sm w-40"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-medium text-gray-600 mb-1",children:b("priceLists.validTo")}),e.jsx("input",{type:"date",value:J,onChange:e=>W(e.target.value),className:"input-field text-sm w-40"})]}),e.jsxs("button",{onClick:async()=>{const e=await t.put(`/listini/${encodeURIComponent(i.customLstCod)}/validita`,{validoDal:q,validoAl:J});e?.success?(N.success(b("priceLists.datesUpdated")),Q(!1),l()):N.error(e?.message||b("common.error"))},className:"btn-primary text-sm flex items-center gap-1",children:[e.jsx(d,{size:14})," ",b("common.save")]}),e.jsx("button",{onClick:()=>Q(!1),className:"btn-secondary text-sm",children:b("common.cancel")})]})]}),$&&e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs("div",{className:"card p-3 text-center cursor-pointer hover:shadow-md transition-all",onClick:()=>{I("all"),M(1)},children:[e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:$.total}),e.jsx("p",{className:"text-xs "+("all"===k?"text-primary-600 font-medium":"text-gray-500"),children:b("priceLists.totalProducts")})]}),e.jsxs("div",{className:"card p-3 text-center cursor-pointer hover:shadow-md transition-all",onClick:()=>{I("modified"),M(1)},children:[e.jsx("p",{className:"text-2xl font-bold text-amber-600",children:$.modified}),e.jsx("p",{className:"text-xs "+("modified"===k?"text-primary-600 font-medium":"text-gray-500"),children:b("priceLists.modified")})]}),e.jsxs("div",{className:"card p-3 text-center cursor-pointer hover:shadow-md transition-all",onClick:()=>{I("unchanged"),M(1)},children:[e.jsx("p",{className:"text-2xl font-bold text-gray-400",children:$.unchanged}),e.jsx("p",{className:"text-xs "+("unchanged"===k?"text-primary-600 font-medium":"text-gray-500"),children:b("priceLists.unchanged")})]})]}),e.jsx("div",{className:"flex flex-col sm:flex-row gap-2",children:e.jsxs("form",{onSubmit:e=>{e.preventDefault(),M(1),Y()},className:"flex gap-2 flex-1",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(m,{className:"absolute left-3 top-2.5 text-gray-400",size:18}),e.jsx("input",{type:"text",value:P,onChange:e=>D(e.target.value),placeholder:b("priceLists.searchPlaceholder"),className:"input-field pl-10 text-sm"})]}),e.jsx("button",{type:"submit",className:"btn-primary text-sm",children:b("import.searchBtn")})]})}),e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm","aria-label":b("a11y.tableCaption.priceList"),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left text-gray-600 border-b",children:[e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium",children:b("priceLists.colCode")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium",children:b("priceLists.colDescription")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium",children:b("priceLists.colUm")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium text-right",children:b("priceLists.colPublicPrice")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium text-right",children:b("priceLists.colCustomPrice")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium text-center",children:b("priceLists.colDiff")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium w-20"})]})}),e.jsx("tbody",{children:S?e.jsx("tr",{children:e.jsxs("td",{colSpan:7,className:"text-center py-12 text-gray-400",children:[e.jsx(r,{className:"animate-spin inline mr-2",size:16}),b("app.loading")]})}):0===w.length?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"text-center py-12 text-gray-400",children:b("common.noData")})}):w.map(s=>e.jsxs("tr",{className:"border-t transition-colors "+(s.isModified?"bg-amber-50/50 hover:bg-amber-50":"hover:bg-gray-50"),children:[e.jsx("td",{className:"px-4 py-2.5 font-mono text-xs text-gray-600",children:s.prdCod}),e.jsx("td",{className:"px-4 py-2.5 text-gray-800",children:s.prdDes}),e.jsx("td",{className:"px-4 py-2.5 text-gray-500 text-xs",children:s.prdUm}),e.jsx("td",{className:"px-4 py-2.5 text-right text-gray-500",children:C.currency(s.prezzoPubblico??0)}),e.jsx("td",{className:"px-4 py-2.5 text-right",children:V===s.prdCod?e.jsx("input",{ref:X,type:"number",step:"0.01",min:"0",value:E,onChange:e=>O(e.target.value),onKeyDown:e=>((e,s)=>{"Enter"===e.key&&_(s),"Escape"===e.key&&Z()})(e,s.prdCod),onBlur:()=>Z(),className:"w-28 text-right text-sm border border-primary-400 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-primary-300",autoFocus:!0}):e.jsx("span",{className:"font-medium "+(s.isModified?"text-amber-700":"text-gray-700"),children:C.currency(s.prezzoCustom??s.prezzoPubblico??0)})}),e.jsx("td",{className:"px-4 py-2.5 text-center",children:s.isModified?e.jsxs("span",{className:"inline-flex items-center gap-0.5 text-xs font-medium "+(s.differenza>0?"text-red-600":"text-green-600"),children:[s.differenza>0?e.jsx(x,{size:12}):e.jsx(p,{size:12}),s.diffPerc>0?"+":"",s.diffPerc,"%"]}):e.jsx(u,{size:14,className:"mx-auto text-gray-300"})}),e.jsx("td",{className:"px-4 py-2.5 text-center",children:V===s.prdCod?e.jsxs("div",{className:"flex gap-1 justify-center",children:[e.jsx("button",{onMouseDown:e=>{e.preventDefault(),_(s.prdCod)},disabled:F,className:"p-1 text-green-600 hover:bg-green-50 rounded",children:e.jsx(h,{size:15})}),e.jsx("button",{onMouseDown:e=>{e.preventDefault(),Z()},className:"p-1 text-gray-400 hover:bg-gray-100 rounded",children:e.jsx(g,{size:15})})]}):e.jsx("button",{onClick:()=>(e=>{B(e.prdCod),O(String(e.prezzoCustom??e.prezzoPubblico??0)),setTimeout(()=>X.current?.select(),50)})(s),className:"p-1 text-gray-400 hover:text-primary-600 hover:bg-primary-50 rounded",children:e.jsx(j,{size:15})})})]},s.prdCod))})]})}),R&&R.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:b("import.showing",{from:(R.page-1)*R.pageSize+1,to:Math.min(R.page*R.pageSize,R.total),total:R.total})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>M(e=>Math.max(1,e-1)),disabled:U<=1,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30",children:e.jsx(y,{size:18})}),Array.from({length:Math.min(5,R.totalPages)},(s,t)=>{let a;return a=R.totalPages<=5||U<=3?t+1:U>=R.totalPages-2?R.totalPages-4+t:U-2+t,e.jsx("button",{onClick:()=>M(a),className:"px-3 py-1 rounded text-sm "+(U===a?"bg-primary-600 text-white":"hover:bg-gray-200"),children:a},a)}),e.jsx("button",{onClick:()=>M(e=>Math.min(R.totalPages,e+1)),disabled:U>=R.totalPages,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30",children:e.jsx(f,{size:18})})]})]})]})]})}function z({data:s,loading:t,pagination:i,page:l,setPage:c,readOnly:n}){const{t:o}=v(),d=a();return e.jsxs("div",{className:"card p-0 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm","aria-label":o("a11y.tableCaption.priceList"),children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-50 text-left text-gray-600 border-b",children:[e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium",children:o("priceLists.colCode")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium",children:o("priceLists.colDescription")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium",children:o("priceLists.colUm")}),e.jsx("th",{scope:"col",className:"px-4 py-3 font-medium text-right",children:o("priceLists.colPrice")})]})}),e.jsx("tbody",{children:t?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"text-center py-12 text-gray-400",children:[e.jsx(r,{className:"animate-spin inline mr-2",size:16}),o("app.loading")]})}):0===s.length?e.jsx("tr",{children:e.jsx("td",{colSpan:4,className:"text-center py-12 text-gray-400",children:o("common.noData")})}):s.map((s,t)=>e.jsxs("tr",{className:"border-t hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-2.5 font-mono text-xs text-gray-600",children:s.prdCod}),e.jsx("td",{className:"px-4 py-2.5 text-gray-800",children:s.prdDes}),e.jsx("td",{className:"px-4 py-2.5 text-gray-500 text-xs",children:s.prdUm}),e.jsx("td",{className:"px-4 py-2.5 text-right font-medium",children:d.currency(s.prdPrz??0)})]},t))})]})}),i&&i.totalPages>1&&e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-t bg-gray-50 text-sm",children:[e.jsx("span",{className:"text-gray-500",children:o("import.showing",{from:(i.page-1)*i.pageSize+1,to:Math.min(i.page*i.pageSize,i.total),total:i.total})}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx("button",{onClick:()=>c(e=>Math.max(1,e-1)),disabled:l<=1,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30",children:e.jsx(y,{size:18})}),e.jsx("button",{onClick:()=>c(e=>Math.min(i.totalPages,e+1)),disabled:l>=i.totalPages,className:"p-1.5 rounded hover:bg-gray-200 disabled:opacity-30",children:e.jsx(f,{size:18})})]})]})]})}export{C as default};
